{% macro subfields(hidden_fields, fields, error_class, show_labels=True) -%}
  {% for field in hidden_fields -%}
    {% set ctx=widget.context_for(field) -%}
    {{field.display(**ctx)}}
  {%- endfor %}
  {% for field in fields -%}
    {% set ctx=widget.context_for(field) -%}
    {% if show_labels and field.show_label -%}
    <label for="{{ctx.id}}">{{field.label}}</label><br>
    {%- endif %}
    {% if ctx.errors and field.show_errors -%}
    <span {{widget.j2_attrs({'class':error_class})}}>{{ctx.errors}}</span><br>
    {%- endif %}
    {{field.display(**ctx)}}<br>
  {%- endfor %}
{%- endmacro %}

{% macro table(field, repetitions, attrs=None) -%}
  <table {{widget.j2_attrs(attrs)}}>
    <thead>
      <tr>
        {% for col in field.fields -%}
        <th>{% if col.show_label %}{{col.label}}{% endif %}</th>
        {%- endfor %}
      </tr>
    </thead>
    <tbody>
      {% for i in range(repetitions) %}
        {% set ctx=widget.context_for(i) %}
        {{field.display(**ctx)}}
      {% endfor %}
    </tbody>
  </table>
{%- endmacro %}
