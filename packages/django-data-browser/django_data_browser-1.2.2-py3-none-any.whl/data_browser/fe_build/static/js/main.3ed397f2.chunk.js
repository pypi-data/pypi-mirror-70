(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{10:function(e,t,a){e.exports=a(22)},15:function(e,t,a){},22:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(8),i=a.n(r),o=(a(15),a(9)),s=a(5),c=a(1),u=a(2),d=a(3),h=a(4);a(7);function f(e){return l.a.createElement("button",{type:"button",className:"Link "+(e.className||""),onClick:e.onClick},e.children)}function m(e){return"boolean"===e.lookup.type?l.a.createElement("select",{className:"FilterValue",onChange:e.onChange,value:e.value},l.a.createElement("option",{value:!0},"true"),l.a.createElement("option",{value:!1},"false")):"number"===e.lookup.type?l.a.createElement("input",{className:"FilterValue",type:"number",step:"0",name:e.name,value:e.value,onChange:e.onChange}):l.a.createElement("input",{className:"FilterValue",type:"text",name:e.name,value:e.value,onChange:e.onChange})}var p=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var e=this.props.name,t=this.props.index,a=this.props.lookup,n=this.props.query,r=this.props.config.getFieldType(e);return l.a.createElement("tr",null,l.a.createElement("td",null,l.a.createElement(f,{onClick:function(){return n.removeFilter(t)}},"\u2718")," ",l.a.createElement(f,{onClick:function(){return n.addField(e)}},e)," "),l.a.createElement("td",null,l.a.createElement("select",{className:"Lookup",value:a,onChange:function(e){return n.setFilterLookup(t,e.target.value)}},r.sortedLookups.map((function(e){return l.a.createElement("option",{key:e,value:e},e.replace("_"," "))})))),l.a.createElement("td",null,"="),l.a.createElement("td",null,l.a.createElement(m,{name:"".concat(e,"__").concat(a),value:this.props.value,onChange:function(e){return n.setFilterValue(t,e.target.value)},lookup:r.lookups[a]}),this.props.errorMessage))}}]),a}(l.a.Component);function g(e){return l.a.createElement("form",{className:"Filters"},l.a.createElement("table",{className:"Flat"},l.a.createElement("tbody",null,e.filters.map((function(t,a){return l.a.createElement(p,Object.assign({config:e.config,query:e.query,key:a,index:a},t))})))))}var v=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={isToggleOn:!1},n}return Object(u.a)(a,[{key:"handleClick",value:function(){this.setState((function(e){return{isToggleOn:!e.isToggleOn}}))}},{key:"render",value:function(){return this.state.isToggleOn?l.a.createElement(l.a.Fragment,null,l.a.createElement(f,{className:"ToggleLink",onClick:this.handleClick.bind(this)},"> ",this.props.title),l.a.createElement("div",{className:"ToggleDiv"},this.props.children)):l.a.createElement(f,{className:"ToggleLink",onClick:this.handleClick.bind(this)},"+ ",this.props.title)}}]),a}(l.a.Component);function y(e){var t=e.config.allModelFields[e.model];return l.a.createElement("ul",{className:"FieldsList"},t.sorted_fields.map((function(a){var n=t.fields[a];return l.a.createElement("li",{key:a},n.concrete?l.a.createElement(f,{onClick:function(){return e.query.addFilter("".concat(e.path).concat(a))}},"Y"):l.a.createElement(l.a.Fragment,null,"\xa0\xa0")," ",l.a.createElement(f,{onClick:function(){return e.query.addField("".concat(e.path).concat(a))}},a))})),t.sorted_fks.map((function(a){var n=t.fks[a];return l.a.createElement("li",{key:a},l.a.createElement(v,{title:a},l.a.createElement(y,{config:e.config,query:e.query,model:n.model,path:"".concat(e.path).concat(a,"__")})))})))}function k(e){return l.a.createElement("thead",null,l.a.createElement("tr",null,e.fields.map((function(t,a){var n=e.config.getModelField(t.name);return l.a.createElement("th",{key:t.name},l.a.createElement(f,{onClick:function(){return e.query.removeField(a)}},"\u2718")," ",n.concrete?l.a.createElement(l.a.Fragment,null,l.a.createElement(f,{onClick:function(){return e.query.addFilter(t.name)}},"Y")," ",l.a.createElement(f,{onClick:function(){return e.query.toggleSort(a)}},t.name)," ",{dsc:"\u2191",asc:"\u2193",null:""}[t.sort]):t.name)})),!e.fields.length&&l.a.createElement("th",null,"No fields selected")))}function F(e){return"html"===e.modelField.type?l.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.value}}):String(e.value)}function E(e){return l.a.createElement("tbody",null,e.data.map((function(t,a){return l.a.createElement("tr",{key:a},t.map((function(t,a){return l.a.createElement("td",{key:a},l.a.createElement(F,{value:t,modelField:e.config.getModelField(e.fields[a].name)}))})))})))}function b(e){return l.a.createElement("table",null,l.a.createElement(k,{config:e.config,query:e.query,fields:e.fields}),l.a.createElement(E,{config:e.config,data:e.data,fields:e.fields}))}var C,M=function(e){return l.a.createElement("div",{id:"body"},l.a.createElement("select",{className:"modelSelector",onChange:function(t){return e.query.setModel(t.target.value)},value:e.model},e.config.sortedModels.map((function(e){return l.a.createElement("option",null,e)}))),l.a.createElement(g,{config:e.config,query:e.query,filters:e.filters}),l.a.createElement("p",null,"Showing ",e.data.length," results -"," ",l.a.createElement("a",{href:e.query.getUrlForMedia("csv")},"Download as CSV")," -"," ",l.a.createElement("a",{href:e.query.getUrlForMedia("json")},"View as JSON")," -"," ",l.a.createElement("a",{href:e.query.getUrlForSave()},"Save View")),l.a.createElement("div",{className:"MainSpace"},l.a.createElement("div",null,l.a.createElement(y,{config:e.config,query:e.query,model:e.model,path:""})),l.a.createElement(b,{config:e.config,query:e.query,fields:e.fields,data:e.data})))},j=a(16),q=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={model:e.model,fields:e.fields,filters:e.filters,data:[]},n}return Object(u.a)(a,[{key:"addField",value:function(e){var t=this.state.fields.slice();t.push({name:e,sort:null});var a=this.state.data.map((function(e){return e.concat([""])}));this.handleQueryChange({fields:t,data:a})}},{key:"removeField",value:function(e){var t=this.state.fields.slice();t.splice(e,1);var a=this.state.data.map((function(t){return t.slice(0,e).concat(t.slice(e+1))}));console.log(this.state.data),console.log(a),this.handleQueryChange({fields:t,data:a})}},{key:"toggleSort",value:function(e){var t=this.state.fields[e],a=this.state.fields.slice();a[e]=Object(s.a)({},t,{sort:{asc:"dsc",dsc:null,null:"asc"}[t.sort]}),this.handleQueryChange({fields:a})}},{key:"addFilter",value:function(e){var t=this.getFieldType(e),a=this.state.filters.slice();a.push({errorMessage:null,name:e,lookup:t.defaultLookup,value:this.props.types[t.lookups[t.defaultLookup].type].defaultValue}),this.handleQueryChange({filters:a})}},{key:"removeFilter",value:function(e){var t=this.state.filters.slice();t.splice(e,1),this.handleQueryChange({filters:t})}},{key:"setFilterValue",value:function(e,t){var a=this.state.filters.slice();a[e]=Object(s.a)({},a[e],{value:t}),this.handleQueryChange({filters:a})}},{key:"setFilterLookup",value:function(e,t){var a=this.state.filters.slice();a[e]=Object(s.a)({},a[e],{lookup:t}),this.handleQueryChange({filters:a})}},{key:"setModel",value:function(e){this.handleQueryChange({model:e,fields:[],filters:[],data:[]})}},{key:"fetchData",value:function(e){var t=this;C&&C.abort(),C=new AbortController,fetch(e,{signal:C.signal}).then((function(e){return e.json()})).then((function(e){t.setState(e)}),(function(e){t.setState({error:e})}))}},{key:"componentDidMount",value:function(){var e=this,t=window.location,a=t.origin+t.pathname;j("html"===a.slice(-4));var n=a.slice(0,-4)+"json"+t.search;this.fetchData(n),window.onpopstate=function(t){e.fetchData(n)}}},{key:"handleQueryChange",value:function(e){var t=Object(s.a)({},this.state,{},e);this.setState(e),window.history.pushState(null,null,this.getUrlForQuery(t.model,t.fields,t.filters,"html")),this.fetchData(this.getUrlForQuery(t.model,t.fields,t.filters,"json"))}},{key:"getPartsForQuery",value:function(e,t,a){return{model:e,fields:t.map((function(e){return{asc:"+",dsc:"-",null:""}[e.sort]+e.name})).join(","),query:a.map((function(e){return"".concat(e.name,"__").concat(e.lookup,"=").concat(e.value)})).join("&")}}},{key:"getUrlForSave",value:function(){var e=this.getPartsForQuery(this.state.model,this.state.fields,this.state.filters),t=new URLSearchParams(e).toString();return"".concat(window.location.origin).concat(this.props.adminUrl,"?").concat(t)}},{key:"getUrlForQuery",value:function(e,t,a,n){var l=this.getPartsForQuery(e,t,a),r="".concat(this.props.baseUrl,"query/").concat(l.model);return"".concat(window.location.origin).concat(r,"/").concat(l.fields,".").concat(n,"?").concat(l.query)}},{key:"getUrlForMedia",value:function(e){return this.getUrlForQuery(this.state.model,this.state.fields,this.state.filters,e)}},{key:"getModelField",value:function(e){var t=e.split("__"),a=t.slice(-1),n=this.getFkModel(t.slice(0,-1).join("__"));return this.props.allModelFields[n].fields[a]}},{key:"getFieldType",value:function(e){var t=this.getModelField(e).type;return this.props.types[t]}},{key:"getFkModel",value:function(e){var t=this.state.model;if(e){var a,n=Object(o.a)(e.split("__"));try{for(n.s();!(a=n.n()).done;){var l=a.value;t=this.props.allModelFields[t].fks[l].model}}catch(r){n.e(r)}finally{n.f()}}return t}},{key:"render",value:function(){return l.a.createElement(M,Object.assign({config:{types:this.props.types,allModelFields:this.props.allModelFields,sortedModels:this.props.sortedModels,getFkModel:this.getFkModel.bind(this),getFieldType:this.getFieldType.bind(this),getModelField:this.getModelField.bind(this)},query:{addField:this.addField.bind(this),removeField:this.removeField.bind(this),toggleSort:this.toggleSort.bind(this),addFilter:this.addFilter.bind(this),removeFilter:this.removeFilter.bind(this),setFilterValue:this.setFilterValue.bind(this),setFilterLookup:this.setFilterLookup.bind(this),setModel:this.setModel.bind(this),getUrlForMedia:this.getUrlForMedia.bind(this),getUrlForSave:this.getUrlForSave.bind(this)}},this.state))}}]),a}(l.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var O=JSON.parse(document.getElementById("django-data").textContent);i.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(q,O)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},7:function(e,t,a){}},[[10,1,2]]]);
//# sourceMappingURL=main.3ed397f2.chunk.js.map