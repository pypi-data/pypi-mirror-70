(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{15:function(e,t,n){},20:function(e,t,n){e.exports=n(28)},25:function(e,t,n){},28:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(17),i=n.n(l),o=n(32),c=(n(25),n(6)),s=n(7),u=n(8),d=n(11),h=n(12);n(15);function m(e){return r.a.createElement("button",{type:"button",className:"Link "+(e.className||""),onClick:e.onClick},e.children)}function f(e){return"boolean"===e.lookup.type?r.a.createElement("select",{className:"FilterValue",onChange:e.onChange,value:e.value},r.a.createElement("option",{value:!0},"true"),r.a.createElement("option",{value:!1},"false")):"number"===e.lookup.type?r.a.createElement("input",{className:"FilterValue",type:"number",step:"0",name:e.path,value:e.value,onChange:e.onChange}):r.a.createElement("input",{className:"FilterValue",type:"text",name:e.path,value:e.value,onChange:e.onChange})}var p=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.path,t=this.props.index,n=this.props.lookup,a=this.props.query,l=this.props.query.getFieldType(e);return r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement(m,{onClick:function(){return a.removeFilter(t)}},"\u2718")," ",r.a.createElement(m,{onClick:function(){return a.addField(e)}},e)," "),r.a.createElement("td",null,r.a.createElement("select",{className:"Lookup",value:n,onChange:function(e){return a.setFilterLookup(t,e.target.value)}},l.sortedLookups.map((function(e){return r.a.createElement("option",{key:e,value:e},e.replace("_"," "))})))),r.a.createElement("td",null,"="),r.a.createElement("td",null,r.a.createElement(f,{name:"".concat(e,"__").concat(n),value:this.props.value,onChange:function(e){return a.setFilterValue(t,e.target.value)},lookup:l.lookups[n]}),this.props.errorMessage))}}]),n}(r.a.Component);function y(e){return r.a.createElement("form",{className:"Filters"},r.a.createElement("table",{className:"Flat"},r.a.createElement("tbody",null,e.filters.map((function(t,n){return r.a.createElement(p,Object.assign({query:e.query,key:n,index:n},t))})))))}var v=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={isToggleOn:!1},a}return Object(u.a)(n,[{key:"handleClick",value:function(){this.setState((function(e){return{isToggleOn:!e.isToggleOn}}))}},{key:"render",value:function(){return this.state.isToggleOn?r.a.createElement(r.a.Fragment,null,r.a.createElement(m,{className:"ToggleLink",onClick:this.handleClick.bind(this)},"> ",this.props.title),r.a.createElement("div",{className:"ToggleDiv"},this.props.children)):r.a.createElement(m,{className:"ToggleLink",onClick:this.handleClick.bind(this)},"+ ",this.props.title)}}]),n}(r.a.Component);function g(e){var t=e.query.getModelFields(e.model);return r.a.createElement("ul",{className:"FieldsList"},t.sorted_fks.map((function(n){var a=t.fks[n];return r.a.createElement("li",{key:n},r.a.createElement(v,{title:n},r.a.createElement(g,{query:e.query,model:a.model,path:"".concat(e.path).concat(n,"__")})))})),t.sorted_fields.map((function(n){var a=t.fields[n];return r.a.createElement("li",{key:n},a.concrete?r.a.createElement(m,{onClick:function(){return e.query.addFilter("".concat(e.path).concat(n))}},"Y"):r.a.createElement(r.a.Fragment,null,"\xa0\xa0")," ",r.a.createElement(m,{onClick:function(){return e.query.addField("".concat(e.path).concat(n))}},n))})))}function E(e){return r.a.createElement("thead",null,r.a.createElement("tr",null,e.fields.map((function(t,n){var a=e.query.getField(t.path);return r.a.createElement("th",{key:n},r.a.createElement(m,{onClick:function(){return e.query.removeField(n)}},"\u2718")," ",a.concrete?r.a.createElement(r.a.Fragment,null,r.a.createElement(m,{onClick:function(){return e.query.addFilter(t.path)}},"Y")," ",r.a.createElement(m,{onClick:function(){return e.query.toggleSort(n)}},t.path)," ",{dsc:"\u2191".concat(t.priority),asc:"\u2193".concat(t.priority),null:""}[t.sort]):t.path)})),!e.fields.length&&r.a.createElement("th",null,"No fields selected")))}function k(e){return"html"===e.modelField.type?r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.value}}):String(e.value)}function q(e){return r.a.createElement("tbody",null,e.data.map((function(t,n){return r.a.createElement("tr",{key:n},t.map((function(t,n){return r.a.createElement("td",{key:n},r.a.createElement(k,{query:e.query,value:t,modelField:e.query.getField(e.fields[n].path)}))})))})))}function b(e){return r.a.createElement("table",null,r.a.createElement(E,{query:e.query,fields:e.fields}),r.a.createElement(q,{query:e.query,data:e.data,fields:e.fields}))}function F(e){return r.a.createElement("select",{className:"ModelSelector",onChange:function(t){return e.query.setModel(t.target.value)},value:e.model},e.sortedModels.map((function(e){return r.a.createElement("option",{key:e},e)})))}function C(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"Logo",onClick:function(){return e.query.setModel("")}},"DDB v",e.version))}function j(e){return r.a.createElement("div",{id:"body"},r.a.createElement(C,{query:e.query,version:e.version}),r.a.createElement(F,{query:e.query,sortedModels:e.sortedModels,model:e.model}),r.a.createElement(y,{query:e.query,filters:e.filters}),r.a.createElement("p",null,"Showing ",e.data.length," results -"," ",r.a.createElement("a",{href:e.query.getUrlForMedia("csv")},"Download as CSV")," -"," ",r.a.createElement("a",{href:e.query.getUrlForMedia("json")},"View as JSON")," -"," ",r.a.createElement("a",{href:e.query.getUrlForSave()},"Save View")),r.a.createElement("div",{className:"MainSpace"},r.a.createElement("div",null,r.a.createElement(g,{query:e.query,model:e.model,path:""})),r.a.createElement(b,{query:e.query,fields:e.fields,data:e.data})))}function M(e){return r.a.createElement("div",{id:"body"},r.a.createElement(C,{query:e.query,version:e.version}),r.a.createElement("div",{className:"Index"},r.a.createElement("div",null,r.a.createElement("h1",null,"Models"),r.a.createElement("div",{className:"ModelList"},e.sortedModels.map((function(t){return r.a.createElement("div",{key:t},r.a.createElement("button",{className:"Link",onClick:function(){return e.query.setModel(t)}},t))})))),r.a.createElement("div",null,r.a.createElement("h1",null,"Saved Views"),r.a.createElement("div",{className:"ModelList"}))))}var O=n(19);function w(e){return{model:e.model,fields:e.fields.map((function(e){return e.path+{asc:"+".concat(e.priority),dsc:"-".concat(e.priority),null:""}[e.sort]})).join(","),query:e.filters.map((function(e){return"".concat(e.path,"__").concat(e.lookup,"=").concat(e.value)})).join("&")}}function S(e,t,n){var a=w(t),r="".concat(e,"query/").concat(a.model);return"".concat(window.location.origin).concat(r,"/").concat(a.fields,".").concat(n,"?").concat(a.query)}var N,L=function(){function e(t,n,a){Object(s.a)(this,e),this.config=t,this.query=n,this.handleQueryChange=a}return Object(u.a)(e,[{key:"getField",value:function(e){var t,n=e.split("__"),a=n.slice(-1),r=this.query.model,l=Object(O.a)(n.slice(0,-1));try{for(l.s();!(t=l.n()).done;){var i=t.value;r=this.config.allModelFields[r].fks[i].model}}catch(o){l.e(o)}finally{l.f()}return this.config.allModelFields[r].fields[a]}},{key:"getFieldType",value:function(e){return this.config.types[this.getField(e).type]}},{key:"getModelFields",value:function(e){return this.config.allModelFields[e]}},{key:"getDefaultLookValue",value:function(e){return this.config.types[e.lookups[e.defaultLookup].type].defaultValue}},{key:"addField",value:function(e){var t=this.query.fields.slice();t.push({path:e,sort:null});var n=this.query.data.map((function(e){return e.concat([""])}));this.handleQueryChange({fields:t,data:n})}},{key:"removeField",value:function(e){var t=this.query.fields.slice();t.splice(e,1);var n=this.query.data.map((function(t){return t.slice(0,e).concat(t.slice(e+1))}));this.handleQueryChange({fields:t,data:n})}},{key:"toggleSort",value:function(e){var t=this.query.fields[e],n={asc:"dsc",dsc:null,null:"asc"}[t.sort],a=this.query.fields.slice();t.sort&&(a=a.map((function(e){return Object(c.a)({},e,{priority:null!=e.priority&&e.priority>t.priority?e.priority-1:e.priority})}))),n?(a=a.map((function(e){return Object(c.a)({},e,{priority:null!=e.priority?e.priority+1:e.priority})})))[e]=Object(c.a)({},t,{sort:n,priority:0}):a[e]=Object(c.a)({},t,{sort:null,priority:null}),this.handleQueryChange({fields:a})}},{key:"addFilter",value:function(e){var t=this.getFieldType(e),n=this.query.filters.slice();n.push({errorMessage:null,path:e,lookup:t.defaultLookup,value:this.getDefaultLookValue(t)}),this.handleQueryChange({filters:n})}},{key:"removeFilter",value:function(e){var t=this.query.filters.slice();t.splice(e,1),this.handleQueryChange({filters:t})}},{key:"setFilterValue",value:function(e,t){var n=this.query.filters.slice();n[e]=Object(c.a)({},n[e],{value:t}),this.handleQueryChange({filters:n})}},{key:"setFilterLookup",value:function(e,t){var n=this.query.filters.slice();n[e]=Object(c.a)({},n[e],{lookup:t}),this.handleQueryChange({filters:n})}},{key:"setModel",value:function(e){this.handleQueryChange({model:e,fields:[],filters:[],data:[]})}},{key:"getUrlForSave",value:function(){var e=w(this.query),t=new URLSearchParams(e).toString();return"".concat(window.location.origin).concat(this.config.adminUrl,"?").concat(t)}},{key:"getUrlForMedia",value:function(e){return S(this.config.baseUrl,this.query,e)}}]),e}(),D=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state=e.initialState,a}return Object(u.a)(n,[{key:"fetchData",value:function(e){var t=this,n=S(this.props.config.baseUrl,e,"json");N&&N.abort(),N=new AbortController,fetch(n,{signal:N.signal}).then((function(e){return e.json()})).then((function(e){t.setState(e)}),(function(e){t.setState({error:e})}))}},{key:"componentDidMount",value:function(){var e=this,t={model:this.state.model,fields:this.state.fields,filters:this.state.filters,data:[]};window.history.replaceState(t,null,S(this.props.config.baseUrl,this.state,"html")),this.fetchData(this.state),window.onpopstate=function(t){e.fetchData(t.state),e.setState(t.state)}}},{key:"handleQueryChange",value:function(e){var t=Object(c.a)({},this.state,{},e);this.setState(e);var n={model:t.model,fields:t.fields,filters:t.filters,data:[]};window.history.pushState(n,null,S(this.props.config.baseUrl,t,"html")),this.fetchData(t)}},{key:"render",value:function(){var e=new L(this.props.config,this.state,this.handleQueryChange.bind(this));return this.state.model?r.a.createElement(j,Object.assign({query:e,sortedModels:this.props.config.sortedModels,version:this.props.config.version},this.state)):r.a.createElement(M,{query:e,sortedModels:this.props.config.sortedModels,version:this.props.config.version})}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var _=JSON.parse(document.getElementById("django-data").textContent);_.sentryDsn&&o.a({dsn:_.sentryDsn}),i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(D,_)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[20,1,2]]]);
//# sourceMappingURL=main.d2482cf5.chunk.js.map