(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){},22:function(e,t,n){"use strict";n.r(t);var a,r=n(0),l=n.n(r),i=n(7),s=n.n(i),o=(n(14),n(8)),c=n(1),u=n(2),h=n(3),d=n(4),p=n(5),m=(n(15),n(16));function y(){var e=window.location,t=e.origin+e.pathname;return m("html"===t.slice(-4)),t.slice(0,-4)+"json"+e.search}function f(e){return l.a.createElement("button",{type:"button",className:"Link "+(e.className||""),onClick:e.onClick},e.children)}var g=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"handleRemove",value:function(e){var t=this.props.query.filters.slice();t.splice(this.props.index,1),this.props.handleQueryChange({filters:t})}},{key:"handleLookupChange",value:function(e){var t=this.props.query.filters.slice();t[this.props.index]=Object(c.a)({},t[this.props.index],{lookup:e.target.value}),this.props.handleQueryChange({filters:t})}},{key:"handleValueChange",value:function(e){var t=this.props.query.filters.slice();t[this.props.index]=Object(c.a)({},t[this.props.index],{value:e.target.value}),this.props.handleQueryChange({filters:t})}},{key:"handleAddField",value:function(){var e=this.props.query.fields.slice();e.push({name:this.props.name,sort:null,concrete:!1}),this.props.handleQueryChange({fields:e})}},{key:"render",value:function(){return l.a.createElement("p",{className:this.props.errorMessage?"Error":void 0},l.a.createElement(f,{onClick:this.handleRemove.bind(this)},"\u2718")," ",l.a.createElement(f,{onClick:this.handleAddField.bind(this)},this.props.name)," ",l.a.createElement("select",{value:this.props.lookup,onChange:this.handleLookupChange.bind(this)},this.props.getFieldType(this.props.name).lookups.map((function(e){return l.a.createElement("option",{key:e.name,value:e.name},e.name)})))," ","="," ",l.a.createElement("input",{type:"text",name:"".concat(this.props.name,"__").concat(this.props.lookup),value:this.props.value,onChange:this.handleValueChange.bind(this)}),this.props.errorMessage)}}]),n}(l.a.Component);function v(e){return l.a.createElement("form",{className:"Filters"},e.query.filters.map((function(t,n){return l.a.createElement(g,Object.assign({},t,{key:n,index:n,query:e.query,handleQueryChange:e.handleQueryChange,getFieldType:e.getFieldType}))})))}var k=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={isToggleOn:!1},a}return Object(h.a)(n,[{key:"handleClick",value:function(){this.setState((function(e){return{isToggleOn:!e.isToggleOn}}))}},{key:"render",value:function(){return this.state.isToggleOn?l.a.createElement(l.a.Fragment,null,l.a.createElement(f,{className:"ToggleLink",onClick:this.handleClick.bind(this)},"> ",this.props.title),l.a.createElement("div",{className:"ToggleDiv"},this.props.children)):l.a.createElement(f,{className:"ToggleLink",onClick:this.handleClick.bind(this)},"+ ",this.props.title)}}]),n}(l.a.Component);function E(e){var t=e.fields[e.model];return l.a.createElement("ul",{className:"FieldsList"},t.sorted_fields.map((function(n){var a=t.fields[n];return l.a.createElement("li",{key:n},e.types[a.type].concrete?l.a.createElement(f,{onClick:function(){var t=e.query.filters.slice();t.push({errorMessage:null,name:"".concat(e.path).concat(n),lookup:"",value:""}),e.handleQueryChange({filters:t})}},"Y"):l.a.createElement(l.a.Fragment,null,"\xa0\xa0")," ",l.a.createElement(f,{onClick:function(){var t=e.query.fields.slice();t.push({name:"".concat(e.path).concat(n),sort:null,concrete:!1}),e.handleQueryChange({fields:t})}},n))})),t.sorted_fks.map((function(n){var a=t.fks[n];return l.a.createElement("li",{key:n},l.a.createElement(k,{title:n},l.a.createElement(E,{query:e.query,handleQueryChange:e.handleQueryChange,fields:e.fields,model:a.model,path:"".concat(e.path).concat(n,"__"),types:e.types})))})))}function C(e){return l.a.createElement("thead",null,l.a.createElement("tr",null,e.query.fields.map((function(t,n){return l.a.createElement("th",{key:t.name},l.a.createElement(f,{onClick:function(){var t=e.query.fields.slice();t.splice(n,1),e.handleQueryChange({fields:t})}},"\u2718")," ",t.concrete?l.a.createElement(l.a.Fragment,null,l.a.createElement(f,{onClick:function(){var n=e.query.filters.slice();n.push({errorMessage:null,name:t.name,lookup:"",value:""}),e.handleQueryChange({filters:n})}},"Y")," ",l.a.createElement(f,{onClick:function(){var a=e.query.fields.slice();a[n]=Object(c.a)({},t,{sort:{asc:"dsc",dsc:null,null:"asc"}[t.sort]}),e.handleQueryChange({fields:a})}},t.name)," ",{dsc:"\u2191",asc:"\u2193",null:""}[t.sort]):t.name)})),!e.query.fields.length&&l.a.createElement("th",null,"No fields selected")))}function b(e){return l.a.createElement("tbody",null,e.data.map((function(e,t){return l.a.createElement("tr",{key:t},e.map((function(e,t){return l.a.createElement("td",{key:t},String(e))})))})))}function q(e){return l.a.createElement("table",null,l.a.createElement(C,{query:e.query,handleQueryChange:e.handleQueryChange}),l.a.createElement(b,{data:e.data}))}function Q(e){return l.a.createElement("div",{id:"body"},l.a.createElement("h1",null,e.model),l.a.createElement("p",null,l.a.createElement("a",{href:e.getUrlForQuery(e.query,"csv")},"Download as CSV")),l.a.createElement("p",null,l.a.createElement("a",{href:e.getUrlForQuery(e.query,"json")},"View as JSON")),l.a.createElement("p",null,l.a.createElement("a",{href:e.saveLink},"Save View")),l.a.createElement(v,{query:e.query,handleQueryChange:e.handleQueryChange,getFieldType:e.getFieldType}),l.a.createElement("p",null,"Showing ",e.data.length," results"),l.a.createElement("div",{className:"MainSpace"},l.a.createElement("div",null,l.a.createElement(E,{query:e.query,handleQueryChange:e.handleQueryChange,fields:e.fields,model:e.model,path:"",types:e.types})),l.a.createElement(q,{query:e.query,handleQueryChange:e.handleQueryChange,data:e.data})))}var F=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={data:[],query:{filters:[],fields:[]}},a}return Object(h.a)(n,[{key:"fetchData",value:function(e){var t=this;a&&a.abort(),a=new AbortController,fetch(e,{signal:a.signal}).then((function(e){return e.json()})).then((function(e){t.setState({data:e.data,query:{fields:e.fields,filters:e.filters}})}),(function(e){t.setState({error:e})}))}},{key:"componentDidMount",value:function(){var e=this;this.fetchData(y()),window.onpopstate=function(t){e.fetchData(y())}}},{key:"handleQueryChange",value:function(e){var t=Object(c.a)({},this.state.query,{},e);this.setState({query:t}),window.history.pushState(null,null,this.getUrlForQuery(t,"html")),this.fetchData(this.getUrlForQuery(t,"json"))}},{key:"getPartsForQuery",value:function(e){return{app:this.props.model.split(".")[0],model:this.props.model.split(".")[1],fields:e.fields.map((function(e){return{asc:"+",dsc:"-",null:""}[e.sort]+e.name})).join(","),query:e.filters.map((function(e){return"".concat(e.name,"__").concat(e.lookup,"=").concat(e.value)})).join("&")}}},{key:"getSaveUrl",value:function(e){var t=this.getPartsForQuery(this.state.query),n=new URLSearchParams(t).toString();return"".concat(window.location.origin).concat(this.props.adminUrl,"?").concat(n)}},{key:"getUrlForQuery",value:function(e,t){var n=this.getPartsForQuery(e),a="".concat(this.props.baseUrl,"query/").concat(n.app,"/").concat(n.model);return"".concat(window.location.origin).concat(a,"/").concat(n.fields,".").concat(t,"?").concat(n.query)}},{key:"getFieldType",value:function(e){var t=e.split("__"),n=t.slice(-1),a=this.getFkModel(t.slice(0,-1).join("__")),r=this.props.fields[a].fields[n].type;return this.props.types[r]}},{key:"getFkModel",value:function(e){var t=this.props.model;if(e){var n,a=Object(o.a)(e.split("__"));try{for(a.s();!(n=a.n()).done;){var r=n.value;t=this.props.fields[t].fks[r].model}}catch(l){a.e(l)}finally{a.f()}}return t}},{key:"render",value:function(){return l.a.createElement(Q,{data:this.state.data,query:this.state.query,handleQueryChange:this.handleQueryChange.bind(this),model:this.props.model,saveLink:this.getSaveUrl(),getUrlForQuery:this.getUrlForQuery.bind(this),getFkModel:this.getFkModel.bind(this),getFieldType:this.getFieldType.bind(this),fields:this.props.fields,types:this.props.types})}}]),n}(l.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var j=JSON.parse(document.getElementById("django-data").textContent);s.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(F,j)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},9:function(e,t,n){e.exports=n(22)}},[[9,1,2]]]);
//# sourceMappingURL=main.3d0445a7.chunk.js.map