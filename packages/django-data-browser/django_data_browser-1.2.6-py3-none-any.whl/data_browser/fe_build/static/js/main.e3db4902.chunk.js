(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{13:function(e,t,n){},14:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var a,r=n(0),l=n.n(r),i=n(7),s=n.n(i),o=(n(13),n(1)),c=n(2),u=n(3),h=n(4),d=n(5),m=(n(14),n(15));function p(){var e=window.location,t=e.origin+e.pathname;return m("html"===t.slice(-4)),t.slice(0,-4)+"json"+e.search}function f(e){return l.a.createElement("button",{type:"button",className:"Link "+(e.className||""),onClick:e.onClick},e.children)}var y=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"handleRemove",value:function(e){var t=this.props.query.filters.slice();t.splice(this.props.index,1),this.props.handleQueryChange({filters:t})}},{key:"handleLookupChange",value:function(e){var t=this.props.query.filters.slice();t[this.props.index]=Object(o.a)({},t[this.props.index],{lookup:e.target.value}),this.props.handleQueryChange({filters:t})}},{key:"handleValueChange",value:function(e){var t=this.props.query.filters.slice();t[this.props.index]=Object(o.a)({},t[this.props.index],{value:e.target.value}),this.props.handleQueryChange({filters:t})}},{key:"getLookups",value:function(){return function e(t,n){return t.length>1?e(t.slice(1),n.fks.find((function(e){return e.name===t[0]}))):n.fields.find((function(e){return e.name===t[0]}))}(this.props.filter.name.split("__"),this.props.allFields).lookups}},{key:"render",value:function(){return l.a.createElement("p",{className:this.props.filter.errorMessage?"Error":void 0},l.a.createElement(f,{onClick:this.handleRemove.bind(this)},"\u2718")," ",this.props.filter.name," ",l.a.createElement("select",{value:this.props.filter.lookup,onChange:this.handleLookupChange.bind(this)},this.getLookups().map((function(e){return l.a.createElement("option",{key:e,value:e},e)})))," ","="," ",l.a.createElement("input",{type:"text",name:"".concat(this.props.filter.name,"__").concat(this.props.filter.lookup),value:this.props.filter.value,onChange:this.handleValueChange.bind(this)}),this.props.filter.errorMessage)}}]),n}(l.a.Component);function g(e){return l.a.createElement("form",{className:"Filters"},e.query.filters.map((function(t,n){return l.a.createElement(y,{filter:t,allFields:e.allFields,key:n,index:n,query:e.query,handleQueryChange:e.handleQueryChange})})))}var v=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={isToggleOn:!1},a}return Object(u.a)(n,[{key:"handleClick",value:function(){this.setState((function(e){return{isToggleOn:!e.isToggleOn}}))}},{key:"render",value:function(){return this.state.isToggleOn?l.a.createElement(l.a.Fragment,null,l.a.createElement(f,{className:"ToggleLink",onClick:this.handleClick.bind(this)},"> ",this.props.title),l.a.createElement("div",{className:"ToggleDiv"},this.props.children)):l.a.createElement(f,{className:"ToggleLink",onClick:this.handleClick.bind(this)},"+ ",this.props.title)}}]),n}(l.a.Component);function k(e){return l.a.createElement("ul",{className:"FieldsList"},e.fields.map((function(t){return l.a.createElement("li",{key:t.name},t.concrete?l.a.createElement(f,{onClick:function(){var n=e.query.filters.slice();n.push({errorMessage:null,name:t.name,lookup:"",value:""}),e.handleQueryChange({filters:n})}},"Y"):l.a.createElement(l.a.Fragment,null,"\xa0\xa0")," ",l.a.createElement(f,{onClick:function(){var n=e.query.fields.slice();n.push({name:t.name,sort:null,concrete:!1}),e.handleQueryChange({fields:n})}},t.name))})),e.fks.map((function(e){return l.a.createElement("li",{key:e.name},l.a.createElement(v,{title:e.name},l.a.createElement(k,e)))})))}function E(e){return l.a.createElement("thead",null,l.a.createElement("tr",null,e.query.fields.map((function(t,n){return l.a.createElement("th",{key:t.name},l.a.createElement(f,{onClick:function(){var t=e.query.fields.slice();t.splice(n,1),e.handleQueryChange({fields:t})}},"\u2718")," ",t.concrete?l.a.createElement(l.a.Fragment,null,l.a.createElement(f,{onClick:function(){var n=e.query.filters.slice();n.push({errorMessage:null,name:t.name,lookup:"",value:""}),e.handleQueryChange({filters:n})}},"Y")," ",l.a.createElement(f,{onClick:function(){var a=e.query.fields.slice();a[n]=Object(o.a)({},t,{sort:{asc:"dsc",dsc:null,null:"asc"}[t.sort]}),e.handleQueryChange({fields:a})}},t.name)," ",{dsc:"\u2191",asc:"\u2193",null:""}[t.sort]):t.name)})),!e.query.fields.length&&l.a.createElement("th",null,"No fields selected")))}function C(e){return l.a.createElement("tbody",null,e.data.map((function(e,t){return l.a.createElement("tr",{key:t},e.map((function(e,t){return l.a.createElement("td",{key:t},e)})))})))}function b(e){return l.a.createElement("table",null,l.a.createElement(E,{query:e.query,handleQueryChange:e.handleQueryChange}),l.a.createElement(C,{data:e.data}))}function q(e){return l.a.createElement("div",{id:"body"},l.a.createElement("h1",null,e.model),l.a.createElement("p",null,l.a.createElement("a",{href:e.csvLink},"Download as CSV")),l.a.createElement("p",null,l.a.createElement("a",{href:e.saveLink},"Save View")),l.a.createElement(g,{query:e.query,handleQueryChange:e.handleQueryChange,allFields:e.allFields}),l.a.createElement("p",null,"Showing ",e.data.length," results"),l.a.createElement("div",{className:"MainSpace"},l.a.createElement("div",null,l.a.createElement(k,Object.assign({query:e.query,handleQueryChange:e.handleQueryChange},e.allFields))),l.a.createElement(b,{query:e.query,handleQueryChange:e.handleQueryChange,data:e.data})))}var Q=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={data:[],query:{filters:[],fields:[]}},a}return Object(u.a)(n,[{key:"fetchData",value:function(e){var t=this;a&&a.abort(),a=new AbortController,fetch(e,{signal:a.signal}).then((function(e){return e.json()})).then((function(e){t.setState({data:e.data,query:{fields:e.fields,filters:e.filters}})}),(function(e){t.setState({error:e})}))}},{key:"componentDidMount",value:function(){var e=this;this.fetchData(p()),window.onpopstate=function(t){e.fetchData(p())}}},{key:"handleQueryChange",value:function(e){var t=Object(o.a)({},this.state.query,{},e);this.setState({query:t}),window.history.pushState(null,null,this.getUrlForQuery(t,"html")),this.fetchData(this.getUrlForQuery(t,"json"))}},{key:"getPartsForQuery",value:function(e){return{app:this.props.app,model:this.props.model,fields:e.fields.map((function(e){return{asc:"+",dsc:"-",null:""}[e.sort]+e.name})).join(","),query:e.filters.map((function(e){return"".concat(e.name,"__").concat(e.lookup,"=").concat(e.value)})).join("&")}}},{key:"getSaveUrl",value:function(e){var t=this.getPartsForQuery(this.state.query),n=new URLSearchParams(t).toString();return"".concat(window.location.origin).concat(this.props.adminUrl,"?").concat(n)}},{key:"getUrlForQuery",value:function(e,t){var n=this.getPartsForQuery(e),a="".concat(this.props.baseUrl,"query/").concat(n.app,"/").concat(n.model);return"".concat(window.location.origin).concat(a,"/").concat(n.fields,".").concat(t,"?").concat(n.query)}},{key:"render",value:function(){return l.a.createElement(q,{data:this.state.data,query:this.state.query,allFields:this.props.allFields,handleQueryChange:this.handleQueryChange.bind(this),model:this.props.model,saveLink:this.getSaveUrl(),csvLink:this.getUrlForQuery(this.state.query,"csv")})}}]),n}(l.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var j=JSON.parse(document.getElementById("django-data").textContent);s.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(Q,j)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},8:function(e,t,n){e.exports=n(21)}},[[8,1,2]]]);
//# sourceMappingURL=main.e3db4902.chunk.js.map