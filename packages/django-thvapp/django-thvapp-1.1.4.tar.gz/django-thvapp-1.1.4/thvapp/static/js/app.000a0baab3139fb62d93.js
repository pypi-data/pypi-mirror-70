webpackJsonp([1],{"1uuo":function(e,t){},IznD:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("7+uW"),a={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var o=n("VU/8")({name:"App"},a,!1,function(e){n("gsu9")},null,null).exports,i=n("/ocq"),r={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"hello"},[n("h1",[e._v(e._s(e.msg))]),e._v(" "),n("h2",[e._v("Essential Links")]),e._v(" "),e._m(0),e._v(" "),n("h2",[e._v("Ecosystem")]),e._v(" "),e._m(1)])},staticRenderFns:[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",[n("li",[n("a",{attrs:{href:"https://vuejs.org",target:"_blank"}},[e._v("\n        Core Docs\n      ")])]),e._v(" "),n("li",[n("a",{attrs:{href:"https://forum.vuejs.org",target:"_blank"}},[e._v("\n        Forum\n      ")])]),e._v(" "),n("li",[n("a",{attrs:{href:"https://chat.vuejs.org",target:"_blank"}},[e._v("\n        Community Chat\n      ")])]),e._v(" "),n("li",[n("a",{attrs:{href:"https://twitter.com/vuejs",target:"_blank"}},[e._v("\n        Twitter\n      ")])]),e._v(" "),n("br"),e._v(" "),n("li",[n("a",{attrs:{href:"http://vuejs-templates.github.io/webpack/",target:"_blank"}},[e._v("\n        Docs for This Template\n      ")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("a",{attrs:{href:"http://router.vuejs.org/",target:"_blank"}},[this._v("\n        vue-router\n      ")])]),this._v(" "),t("li",[t("a",{attrs:{href:"http://vuex.vuejs.org/",target:"_blank"}},[this._v("\n        vuex\n      ")])]),this._v(" "),t("li",[t("a",{attrs:{href:"http://vue-loader.vuejs.org/",target:"_blank"}},[this._v("\n        vue-loader\n      ")])]),this._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/vuejs/awesome-vue",target:"_blank"}},[this._v("\n        awesome-vue\n      ")])])])}]};var l=n("VU/8")({name:"HelloWorld",data:function(){return{msg:"Welcome to Your Vue.js App"}}},r,!1,function(e){n("1uuo")},"data-v-d8ec41bc",null).exports,c={name:"AppList",data:function(){return{apps:[],centerDialogVisible:!1,startApp:"",loadPercent:0,curW:{},searchApp:"",appNames:[],showApps:[],loading:!0,listAppURI:"/list/app",closeVappURI:"/close/app"}},methods:{rightClick:function(e,t,n,s){var a=this;if(this.menuVisible=!1,this.menuVisible=!0,null!=localStorage.getItem(this.generateVncKey(t,n,s))){var o="yes"===s?"使用远程GPU加速":"";this.$confirm("应用"+t+"-"+n+o+",已经启动，您是否关闭原连接启动新应用?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){null!=localStorage.getItem("win_"+a.generateVncKey(t,n,s))&&(a.closeApp(t,n,s,{path:"/appshow",name:"AppShow",query:{vapp:t,version:n,gpu:s}},!0),a.curW[a.generateVncKey(t,n,s)].close())}).catch(function(){console.log("not start new")})}else{var i=this.$router.resolve({name:"AppShow",query:{vapp:t,version:n,gpu:s,newTab:"yes"}});this.curW[this.generateVncKey(t,n,s)]=window.open(i.href,"_blank"),localStorage.setItem("win_"+this.generateVncKey(t,n,s),"win_"+this.generateVncKey(t,n,s))}},loadingApp:function(){var e=Math.floor(8*Math.random())+8;this.loadPercent+e<100&&(this.loadPercent=this.loadPercent+e)},closeApp:function(e,t,n,s,a){var o=this,i={vapp:e,version:t,gpu:"yes"===n?1:0};this.axios.post(this.closeVappURI,i).then(function(i){if(console.log(i.data),"yes"===i.data.success)if(null!=localStorage.getItem("win_"+o.generateVncKey(e,t,n))&&(o.curW[o.generateVncKey(e,t,n)].close(),localStorage.removeItem("win_"+o.generateVncKey(e,t,n))),localStorage.removeItem(o.generateVncKey(e,t,n)),console.log("close visual app["+e+"_"+t+"_"+n+"] success!"),a){var r=o.$router.resolve({name:"AppShow",query:{vapp:e,version:t,gpu:n,newTab:"yes"}});o.curW[o.generateVncKey(e,t,n)]=window.open(r.href,"_blank"),localStorage.setItem("win_"+o.generateVncKey(e,t,n),"win_"+o.generateVncKey(e,t,n))}else o.$router.push(s)}).catch(function(s){alert(s),localStorage.removeItem(o.generateVncKey(e,t,n)),localStorage.removeItem("win_"+o.generateVncKey(e,t,n))})},appFilter:function(e){return function(t){return 0===t.app.toLowerCase().indexOf(e.toLowerCase())}},querySearch:function(e,t){e=e.trim();var n=this.appNames,s=this.apps;console.log(n);var a=e?s.filter(this.appFilter(e)):s;this.showApps=a,console.log(a),t(a)},handleSelect:function(e){console.log(e),this.showApps=[e]},handleInput:function(e){""===e&&(this.showApps=this.apps)},generateVncKey:function(e,t,n){return e+"_"+t+"_"+n},routerTo:function(e,t,n){var s=this;if(null!=localStorage.getItem(this.generateVncKey(e,t,n))){var a="yes"===n?"使用远程GPU加速":"";this.$confirm("应用"+e+"-"+t+a+",已经启动，您是否关闭原连接启动新应用?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){null!=localStorage.getItem("win_"+s.generateVncKey(e,t,n))&&(s.closeApp(e,t,n,{path:"/appshow",name:"AppShow",query:{vapp:e,version:t,gpu:n}},!1),s.curW[s.generateVncKey(e,t,n)].close())}).catch(function(){console.log("not start new")})}else this.$router.push({path:"/appshow",name:"AppShow",query:{vapp:e,version:t,gpu:n}})}},created:function(){var e=this;this.axios.post(this.listAppURI).then(function(t){console.log(t.data),"yes"===t.data.success&&(console.log(t.data.apps),e.apps=t.data.apps,e.showApps=t.data.apps,e.loading=!1)}).catch(function(e){alert(e)})},mounted:function(){for(var e=0;e<this.apps.length;e++)this.appNames.push({value:this.apps[e].app,version:this.apps[e].defaultVersion})}},p={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-row",{staticStyle:{"margin-bottom":"5px"}},[n("el-col",{staticStyle:{"text-align":"left","padding-left":"10px","font-size":"x-large","font-family":"Hiragino Sans GB","font-weight":"bold"},attrs:{xs:16,sm:20,md:20,lg:22,xl:16}},[n("i",{staticClass:"el-icon-video-camera"}),n("i",{staticClass:"el-icon-right"})]),e._v(" "),n("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{xs:8,sm:4,md:4,lg:2,xl:8}},[n("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.querySearch,placeholder:"找应用","trigger-on-focus":!1},on:{select:e.handleSelect,input:e.handleInput},model:{value:e.searchApp,callback:function(t){e.searchApp=t},expression:"searchApp"}},[n("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1)],1),e._v(" "),n("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"panel-group",attrs:{gutter:30}},e._l(e.showApps,function(t,s){return n("el-col",{key:s,staticClass:"card-panel-col",staticStyle:{"margin-bottom":"20px"},attrs:{xs:12,sm:12,lg:6}},[n("el-row",{staticStyle:{"padding-bottom":"5px","box-shadow":"0 0px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .4)"}},[n("el-col",{staticStyle:{"font-size":"x-large","font-family":"Hiragino Sans GB","font-weight":"bold"}},[e._v(e._s(t.app))])],1),e._v(" "),n("el-row",[t.showVideo?n("div",{staticClass:"el-image"},[n("video",{staticClass:"video",staticStyle:{width:"100%"},attrs:{src:t.video,autoplay:"",loop:"",muted:""},domProps:{muted:!0}})]):n("el-image",{staticStyle:{width:"100%"},attrs:{src:t.image}},[n("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[e._v("\r\n            加载中"),n("span",{staticClass:"dot"},[e._v("...")])])])],1),e._v(" "),n("el-row",{staticStyle:{"margin-bottom":"5px"}},[n("el-col",[n("el-select",{staticStyle:{width:"49%"},attrs:{filterable:"",placeholder:"版本"},model:{value:t.defaultVersion,callback:function(n){e.$set(t,"defaultVersion",n)},expression:"item.defaultVersion"}},e._l(t.versions,function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})}),1),e._v(" "),n("el-select",{staticStyle:{width:"49%"},attrs:{filterable:"",placeholder:"GPU加速"},model:{value:t.defaultGPU,callback:function(n){e.$set(t,"defaultGPU",n)},expression:"item.defaultGPU"}},e._l(t.gpus,function(e){return n("el-option",{key:e.key,attrs:{label:e.lab,value:e.val}})}),1)],1)],1),e._v(" "),n("el-row",[n("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"右键新窗口打开",placement:"top","hide-after":5e3}},[n("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",plain:""},on:{click:function(n){return e.routerTo(t.app,t.defaultVersion,t.defaultGPU)}},nativeOn:{contextmenu:function(n){return n.preventDefault(),e.rightClick(n,t.app,t.defaultVersion,t.defaultGPU)}}},[e._v("打开")])],1)],1)],1)}),1),e._v(" "),n("el-dialog",{attrs:{title:e.startApp,visible:e.centerDialogVisible,width:"30%",center:"","show-close":!1},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[n("el-progress",{attrs:{"text-inside":!0,"stroke-width":24,percentage:e.loadPercent,status:"success"}})],1)],1)},staticRenderFns:[]};var u=n("VU/8")(c,p,!1,function(e){n("lZSu"),n("YQrG")},"data-v-7eb84e2e",null).exports,h=n("spun"),d=n.n(h),g=n("y7PL"),v=n.n(g),f={name:"AppShow",data:function(){return{rfb:null,status:"Loading",vappVersion:"",vapp:"",version:"",gpu:"",winwidth:1024,winHeight:768,notNewTab:!0,gap_time:0,beforeUnload_time:0,centerDialogVisible:!1,loadPercent:0,startApp:"",vappHasClosed:!1,startOK:!1,isFullscreen:!1,renderInfo:"",openAppURI:"/open/app",closeVappURI:"/close/app"}},methods:{goBack:function(){var e=this;console.log("go back"),this.vappHasClosed?this.$router.push({name:"AppList"}):this.$confirm("返回应用列表将会自动关闭当前应用?您确定吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.closeVapp()}).catch(function(){console.log("stay here")})},getWinSize:function(){this.winwidth=document.body.clientWidth,this.winHeight=document.documentElement.clientHeight||document.body.clientHeight},unloadFn:function(){this.gap_time=(new Date).getTime()-this.beforeUnload_time,this.gap_time<=5&&alert("close")},beforeunloadFn:function(){alert("ccc"),this.beforeUnload_time=(new Date).getTime()},beforeunloadHandler:function(){alert("ddd"),this.beforeUnload_time=(new Date).getTime()},unloadHandler:function(){alert("close"),this.gap_time=(new Date).getTime()-this.beforeUnload_time,this.gap_time<=5?(alert("关闭"),this.showLoginButton):alert("刷新")},fullscreenFunc:function(){if(!v.a.isEnabled)return this.$message({message:"您的浏览器无法进去全屏模式！",type:"warning"}),!1;v.a.toggle(),this.isFullscreen=!0},refreshFunc:function(){this.$router.go(0)},loadingApp:function(){var e=Math.floor(8*Math.random())+8;this.loadPercent+e>=100&&this.startOK?this.loadPercent=100:this.loadPercent+e>=100&&!this.startOK?this.loadPercent=99:this.loadPercent=this.loadPercent+e},generateVncKey:function(){return this.vapp+"_"+this.version+"_"+this.gpu},saveSocketToLS:function(){var e=this.generateVncKey();null==localStorage.getItem(e)&&localStorage.setItem(e,this.rfb)},connectedToServer:function(){this.status="Connected","yes"===this.gpu?this.renderInfo="-[GPU rendering accelerating by TianHe System]":this.renderInfo="-[rendering by TianHe System]"},disconnectedFromServer:function(e){console.log(e),e.detail.clean?this.status="Disconnected":this.status="Something went wrong, connection is closed"},credentialsAreRequired:function(){var e=prompt("Password Required:");this.rfb.sendCredentials({password:e})},clipboardReceive:function(e){window.console.log(e.detail.text)},clipboardClear:function(){this.rfb.clipboardPasteFrom("")},clipboardSend:function(){this.rfb.clipboardPasteFrom("textCopy")},connect:function(){var e=this;this.getWinSize(),console.log(this.winwidth),console.log(this.winHeight);var t={vapp:this.vapp,version:this.version,gpu:"yes"===this.gpu?1:0,winWidth:this.winwidth,winHeight:this.winHeight},n=this.openAppURI;this.axios.post(n,t).then(function(t){console.log(t.data);var n=t.data.wsURI,s=t.data.vncYao;e.loadPercent=100,e.startOK=!0,console.log(e.loadPercent),clearInterval(e.timer),setTimeout(function(){e.centerDialogVisible=!1,console.log(e.$refs.vnc_console),e.rfb=new d.a(e.$refs.vnc_console,n,{shared:!1,credentials:{password:s}}),console.log(e.rfb),e.rfb.addEventListener("connect",e.connectedToServer),e.rfb.addEventListener("disconnect",e.disconnectedFromServer),e.rfb.addEventListener("credentialsrequired",e.credentialsAreRequired),e.rfb.addEventListener("clipboard",e.clipboardReceive),e.rfb.viewOnly=!1,e.saveSocketToLS()},500)}).catch(function(t){console.log(t),e.$message.error("启动应用失败"),e.centerDialogVisible=!1,e.loadPercent=0,clearInterval(e.timer),e.vappHasClosed=!0})},closeVapp:function(){var e=this,t={vapp:this.vapp,version:this.version,gpu:"yes"===this.gpu?1:0,winWidth:this.winwidth,winHeight:this.winHeight};this.axios.post(this.closeVappURI,t).then(function(t){console.log(t.data),"yes"===t.data.success&&(e.vappHasClosed=!0,localStorage.removeItem(e.generateVncKey()),"yes"===e.gpu&&localStorage.removeItem("win_"+e.generateVncKey()),e.notNewTab?e.$router.push({name:"AppList"}):window.close())}).catch(function(t){console.log(t),localStorage.removeItem(e.generateVncKey()),e.notNewTab?e.$router.push({name:"AppList"}):window.close()}),this.isFullscreen&&(v.a.toggle(),this.isFullscreen=!1)}},mounted:function(){var e=this;window.addEventListener("beforeunload",function(t){return e.beforeunloadFn()}),window.addEventListener("unload",function(t){return e.unloadFn()}),this.vapp=this.$route.query.vapp,this.version=this.$route.query.version,this.gpu=this.$route.query.gpu,this.notNewTab=!("yes"===this.$route.query.newTab),this.oldVnc=this.$route.query.old,console.log(this.vapp),console.log(this.version),console.log(this.gpu),console.log(this.notNewTab),this.startApp="启动 "+this.vapp+"-"+this.version+" ......",this.vappVersion=this.vapp+"-"+this.version,this.notNewTab,this.centerDialogVisible=!0,this.timer=setInterval(this.loadingApp,300),this.connect()},destroyed:function(){var e=this;window.removeEventListener("beforeunload",function(t){return e.beforeunloadFn(t)}),window.removeEventListener("unload",function(t){return e.unloadFn(t)})}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-row",[n("el-col",{directives:[{name:"show",rawName:"v-show",value:e.notNewTab,expression:"notNewTab"}],attrs:{xs:16,sm:20,md:20,lg:22,xl:22}},[n("el-page-header",{directives:[{name:"show",rawName:"v-show",value:e.notNewTab,expression:"notNewTab"}],staticStyle:{"padding-top":"8px"},attrs:{title:"返回可视化列表",content:e.vappVersion},on:{back:e.goBack}})],1),e._v(" "),n("el-col",{directives:[{name:"show",rawName:"v-show",value:!e.notNewTab,expression:"!notNewTab"}],attrs:{xs:16,sm:20,md:20,lg:22,xl:22}},[n("div",{staticStyle:{"text-align":"left","margin-top":"10px","margin-left":"5px","font-family":"'Avenir', Helvetica, Arial, sans-serif","font-size":"18px",color:"#303133"}},[e._v(e._s(e.vappVersion))])]),e._v(" "),n("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{xs:8,sm:4,md:4,lg:2,xl:2}},[n("el-button",{attrs:{type:"text",icon:"el-icon-circle-close"},on:{click:e.closeVapp}},[e._v("关闭")])],1)],1),e._v(" "),n("div",{attrs:{id:"top_bar"}},[n("el-row",[n("el-col",{attrs:{xs:4,sm:4,md:4,lg:2,xl:2}},[n("div",{staticStyle:{"text-align":"left","padding-left":"10px"},on:{click:e.refreshFunc}},[n("i",{staticClass:"el-icon-refresh-right"})])]),e._v(" "),n("el-col",{attrs:{xs:16,sm:16,md:16,lg:20,xl:20}},[n("div",[e._v("TH-VApp-"+e._s(e.status)+e._s(e.renderInfo))])]),e._v(" "),n("el-col",{attrs:{xs:4,sm:4,md:4,lg:2,xl:2}},[n("div",{staticStyle:{"text-align":"right","padding-right":"10px"},on:{click:e.fullscreenFunc}},[n("i",{staticClass:"el-icon-full-screen"})])])],1)],1),e._v(" "),n("div",{ref:"vnc_console",staticClass:"screen"}),e._v(" "),n("el-dialog",{attrs:{title:e.startApp,visible:e.centerDialogVisible,width:"30%",center:"","show-close":!1},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[n("el-progress",{attrs:{"text-inside":!0,"stroke-width":24,percentage:e.loadPercent,status:"success"}})],1)],1)},staticRenderFns:[]};var w=n("VU/8")(f,m,!1,function(e){n("IznD"),n("r5ud")},"data-v-09007d79",null).exports;s.default.use(i.a);var _=new i.a({routes:[{path:"/",name:"HelloWorld",component:l},{path:"/applist",name:"AppList",component:u},{path:"/appshow",name:"AppShow",component:w}]}),b=n("mtWM"),y=n.n(b),x=n("Rf8U"),S=n.n(x),V=n("zL8q"),A=n.n(V);n("tvR6");s.default.use(A.a),s.default.use(S.a,y.a),s.default.config.productionTip=!1,y.a.defaults.xsrfHeaderName="X-CSRFToken",y.a.defaults.xsrfCookieName="csrftoken",new s.default({el:"#app",router:_,components:{App:o},template:"<App/>"})},YQrG:function(e,t){},gsu9:function(e,t){},lZSu:function(e,t){},r5ud:function(e,t){},tvR6:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.000a0baab3139fb62d93.js.map