(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{FuSl:function(e,t,a){"use strict";a.r(t);a("5Dmo");var n=a("3S7+"),l=(a("Mwp2"),a("VXEj")),r=(a("IzEo"),a("bx4M")),c=(a("BoS7"),a("Sdc0")),i=(a("jCWc"),a("kPKH")),o=(a("14J3"),a("BMrR")),s=(a("lUTK"),a("BvKs")),u=(a("qVdP"),a("jsC+")),d=(a("MXD1"),a("CFYs")),m=(a("+BJd"),a("mr32")),f=(a("+L6B"),a("2/Rp")),p=(a("2qtc"),a("kLXV")),h=a("p0pE"),g=a.n(h),b=a("2Taf"),E=a.n(b),y=a("vZ4D"),v=a.n(y),C=a("MhPg"),k=a.n(C),S=a("l4Ni"),D=a.n(S),O=a("ujKo"),w=a.n(O),L=(a("7Kak"),a("9yH6")),M=(a("5NDa"),a("5rEg")),j=(a("OaEy"),a("2fM7")),x=a("q1tI"),V=a.n(x),N=a("i8i4"),P=a("wd/R"),I=a.n(P),R=a("MuoO"),B=a("rLCj"),T=a("8Skl"),F=a("xvlK"),Y=a("WsrF"),q=(a("XlDN"),a("WnL9")),K=a("Hx5s"),A=a("c+yx"),H=a("lc5D"),z=a.n(H),W=(a("KWgm"),a("xWKc"),a("xM2q")),J=a("4NGg"),X=a.n(J),U=a("55Ip");function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var a,n=w()(e);if(t){var l=w()(this).constructor;a=Reflect.construct(n,arguments,l)}else a=n.apply(this,arguments);return D()(this,a)}}var $=function(e,t,a,n){var l,r=arguments.length,c=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,a,n);else for(var i=e.length-1;i>=0;i--)(l=e[i])&&(c=(r<3?l(c):r>3?l(t,a,c):l(t,a))||c);return r>3&&c&&Object.defineProperty(t,a,c),c},Z=j.a.Option,Q=Y.a.Item,_=M.a.Search,ee=L.a.Group,te=L.a.Button,ae="connection",ne=function(e){k()(a,e);var t=G(a);function a(){var e;return E()(this,a),(e=t.apply(this,arguments)).state={visible:!1,runVisible:!1,runDone:!1,done:!1,current:void 0,search:"",msg:"",success:!1,submitted:!1,pageSize:5,currentPage:1,tag:"",connector:"",type:""},e.formLayout={labelCol:{span:5},wrapperCol:{span:17}},e.normFile=function(e){return Array.isArray(e)?e:e&&e.fileList},e.doRefresh=function(){(0,e.props.dispatch)({type:"".concat(ae,"/fetch")})},e.showModal=function(){e.setState({visible:!0,submitted:!1,current:{},connector:""})},e.showEditModal=function(t){e.setState({visible:!0,current:t,submitted:!1,connector:t.connector,config:t.config})},e.showManageModal=function(t,a){e.setState({runVisible:!0,runDone:!1,msg:""}),(0,e.props.dispatch)({type:"".concat(ae,"/run"),payload:{method:a,model:ae,id:t.id},callback:function(t){e.setState({msg:t.msg,runDone:!0,success:t.success}),e.doRefresh()}})},e.handleDone=function(){setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),e.setState({done:!1,visible:!1})},e.handleCancel=function(){setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),e.setState({visible:!1})},e.handleUpdate=function(t){e.handleSubmit(t,!0)},e.handleSubmit=function(t,a){t.preventDefault();var n=e.props,l=n.dispatch,r=n.form,c=e.state.current;setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),r.validateFields(function(t,a){t||(e.setState({submitted:!0}),l({type:"".concat(ae,"/submit"),payload:g()({},c,a),callback:function(t){t.success?e.setState({done:!0,success:t.success,msg:t.msg}):e.setState({runDone:!0,success:t.success,msg:t.msg,submitted:!1,runVisible:!0})}}))})},e.deleteItem=function(t){(0,e.props.dispatch)({type:"".concat(ae,"/submit"),payload:{id:t}})},e.onSearch=function(t,a){e.setState({search:t,currentPage:1})},e.getFilterPageData=function(){var t=e.state,a=t.search,n=t.tag,l=e.props.listBasicList.filter(function(e){return(0===a.length||e.name.indexOf(a)>=0)&&(0===n.length||n===e.type)});return l},e.getCurrentPageData=function(){var t=e.state,a=t.pageSize,n=t.currentPage;return e.getFilterPageData().slice((n-1)*a,n*a)},e.onPageChange=function(t,a){e.setState({pageSize:a,currentPage:t})},e.onTagChage=function(t){t.preventDefault(),e.setState({tag:t.target.value})},e.onSelectTypeChange=function(t){var a=A.a[t];void 0!==a&&e.setState({connector:a,current:g()({},e.state.current,{connector:a})})},e}return v()(a,[{key:"componentDidMount",value:function(){this.doRefresh()}},{key:"render",value:function(){var e,t=this,a=["hive","jdbc","kafka","hbase","elasticsearch","filesystem"],h=this.props.loading,b=this.props,E=b.form.getFieldDecorator,y=b.fetchLoading,v=this.state,C=v.visible,k=v.done,S=v.current,D=void 0===S?{}:S,O=v.search,w=v.success,L=v.msg,x=v.submitted,P=v.currentPage,R=k?{footer:null,onCancel:this.handleDone}:{okText:"保存",onOk:this.handleSubmit,onCancel:this.handleCancel,footer:[V.a.createElement(f.a,{key:"back",onClick:this.handleCancel},"取消"),V.a.createElement(f.a,{key:"submit",type:"primary",loading:x,onClick:this.handleSubmit},"保存")]},H=V.a.createElement("div",{className:X.a.extraContent},V.a.createElement(f.a,{onClick:this.doRefresh,disabled:y},V.a.createElement(B.a,null)),V.a.createElement(ee,{defaultValue:null,onChange:this.onTagChage},V.a.createElement(te,{value:""},"全部"),a.map(function(e){return V.a.createElement(te,{key:e,value:e},e)})),V.a.createElement(_,{defaultValue:O,className:X.a.extraContentSearch,placeholder:"请输入",onSearch:this.onSearch})),J=function(e){var t=e.data,a=(t.name,t.type),n=t.isActive,l=t.isLocked,r=t.createAt,c=t.updateAt;return V.a.createElement("div",{className:X.a.listContent},V.a.createElement("div",{className:X.a.listContentItem},V.a.createElement("p",null,V.a.createElement(m.a,null,a))),V.a.createElement("div",{className:X.a.listContentItem},V.a.createElement("span",null,"创建时间"),V.a.createElement("p",null,I()(r).format("YYYY-MM-DD HH:mm"))),V.a.createElement("div",{className:X.a.listContentItem},V.a.createElement("span",null,"修改时间"),V.a.createElement("p",null,I()(c).format("YYYY-MM-DD HH:mm"))),V.a.createElement("div",{className:X.a.listContentItem},V.a.createElement(d.a,{type:"circle",percent:100,status:Object(A.d)(n,l),strokeWidth:1,width:50,style:{width:180}})))},G=this.props.deletable,$=function(e){var a=e.item;return V.a.createElement(u.a,{overlay:V.a.createElement(s.a,{onClick:function(e){return function(e,a){"edit"===e?t.showEditModal(a):"update"==e?t.showManageModal(a,"update"):"clean"==e?t.showManageModal(a,"clean"):"upgrade"==e?t.showManageModal(a,"upgrade"):"delete"===e&&p.a.confirm({title:"删除",content:"确定删除吗？",okText:"确认",cancelText:"取消",onOk:function(){return t.deleteItem(a.id)}})}(e.key,a)}},G&&V.a.createElement(s.a.Item,{key:"delete"},"删除"),V.a.createElement(s.a.Item,{key:"update"},"更新"),V.a.createElement(s.a.Item,{key:"clean"},"清除"))},V.a.createElement("a",null,"更多 ",V.a.createElement(T.a,null)))};return V.a.createElement(V.a.Fragment,null,V.a.createElement(K.b,null,V.a.createElement("div",{className:X.a.standardList},V.a.createElement(r.a,{className:X.a.listCard,bordered:!1,title:"列表",style:{marginTop:24},bodyStyle:{padding:"0 32px 40px 32px"},extra:H},1===P&&V.a.createElement(f.a,{type:"dashed",style:{width:"100%",marginBottom:8},icon:V.a.createElement(F.a,null),onClick:this.showModal,ref:function(e){t.addBtn=Object(N.findDOMNode)(e)}},"添加"),V.a.createElement(l.b,{size:"large",rowKey:"id",loading:h,dataSource:this.getFilterPageData(),renderItem:function(e){return V.a.createElement(l.b.Item,{actions:[V.a.createElement("a",{key:"edit",onClick:function(a){a.preventDefault(),t.showEditModal(e)}},"编辑"),V.a.createElement(U.Link,{to:"/resources/connection/name/".concat(e.id)},"资源"),V.a.createElement($,{key:"more",item:e})]},V.a.createElement(l.b.Item.Meta,{title:V.a.createElement(n.a,{title:e.name,placement:"left"},V.a.createElement("a",{href:"#"},Object(A.c)(e.name))),description:V.a.createElement(n.a,{title:e.info,placement:"left"},V.a.createElement("a",{href:"#"},Object(A.c)(e.info)))}),V.a.createElement(J,{data:e}))}}))),V.a.createElement(p.a,{title:"运行结果",className:X.a.standardListForm,width:1080,bodyStyle:{padding:"72px 0"},destroyOnClose:!0,visible:this.state.runVisible,onCancel:function(e){return t.setState({runVisible:!1})},footer:null,confirmLoading:this.state.done},V.a.createElement(q.a,{type:this.state.runDone?this.state.success?"success":"error":"line",title:this.state.runDone?this.state.success?"运行成功":"运行失败":"提交中...",description:this.state.msg,actions:V.a.createElement(f.a,{loading:!this.state.runDone,type:"primary",onClick:function(e){return t.setState({runVisible:!1})}},"知道了"),className:X.a.formResult}))),V.a.createElement(p.a,Object.assign({title:k?null:"".concat(void 0!==D.id?"编辑":"新增"),className:X.a.standardListForm,width:1080,bodyStyle:k?{padding:"72px 0"}:{padding:"28px 0 0"},destroyOnClose:!0,visible:C},R),(e=void 0===D.id,k?V.a.createElement(q.a,{type:w?"success":"error",title:"操作 ".concat(w?"成功":"失败"),description:w?"":L,actions:V.a.createElement(f.a,{type:"primary",onClick:t.handleDone},"知道了"),className:X.a.formResult}):V.a.createElement(Y.a,{onSubmit:t.handleSubmit},V.a.createElement(Q,Object.assign({label:"名称"},t.formLayout),E("name",{rules:e?W.a:[],initialValue:D.name})(V.a.createElement(M.a,{disabled:!e,placeholder:"请输入"}))),V.a.createElement(Q,Object.assign({label:"介绍"},t.formLayout),E("info",{initialValue:null!==D.info?D.info:"",rules:[{required:!1}]})(V.a.createElement(M.a.TextArea,{placeholder:"简介"}))),V.a.createElement(Q,Object.assign({label:"类型"},t.formLayout),E("type",{initialValue:D.type,rules:[{required:!0}]})(V.a.createElement(j.a,{disabled:!e,size:"middle",style:{width:140},onChange:t.onSelectTypeChange},a.map(function(e){return V.a.createElement(Z,{key:e,value:e},e)})))),V.a.createElement(Q,Object.assign({label:"url"},t.formLayout),E("url",{initialValue:D.url,rules:[{required:!0}]})(V.a.createElement(M.a,{placeholder:"数据库连接url"}))),V.a.createElement(Q,Object.assign({label:"资源过滤正则"},t.formLayout),E("include",{initialValue:null!==D.include?D.include:"",rules:[{required:!1}]})(V.a.createElement(M.a,{placeholder:"使用逗号分割多个正则表达"}))),V.a.createElement(Q,Object.assign({label:"资源排除"},t.formLayout),E("exclude",{initialValue:null!==D.exclude?D.exclude:"",rules:[{required:!1}]})(V.a.createElement(M.a,{placeholder:"使用逗号分割多个正则表达"}))),V.a.createElement(Q,Object.assign({label:"connector"},t.formLayout),V.a.createElement(z.a,{mode:"yaml",onChange:function(e){return t.setState({connector:e,current:g()({},D,{connector:e})})},name:"functionConstructorConfig",editorProps:{$blockScrolling:!0},readOnly:!1,placeholder:"请输入Yaml配置",defaultValue:D.connector,value:t.state.connector,width:765,height:230})),V.a.createElement(Q,Object.assign({label:"config"},t.formLayout),V.a.createElement(z.a,{mode:"ini",onChange:function(e){return t.setState({config:e,current:g()({},D,{config:e})})},name:"functionConstructorConfig",editorProps:{$blockScrolling:!0},readOnly:!1,placeholder:"请输入Yaml配置",defaultValue:D.config,value:null!==t.state.config?t.state.config:"",width:765,height:230})),V.a.createElement(Q,Object.assign({label:"自动更新周期（s）"},t.formLayout),E("updateInterval",{initialValue:D.updateInterval,rules:[{required:!1}]})(V.a.createElement(M.a,{type:"number",placeholder:"秒",width:20}))),V.a.createElement(Q,Object.assign({label:"其他"},t.formLayout),V.a.createElement(o.a,{gutter:16},V.a.createElement(i.a,{span:3},E("isActive",{initialValue:D.isActive,valuePropName:"checked"})(V.a.createElement(c.a,{checkedChildren:"启用",unCheckedChildren:"禁止"}))),V.a.createElement(i.a,{span:3},E("isLocked",{initialValue:D.isLocked,valuePropName:"checked"})(V.a.createElement(c.a,{checkedChildren:"锁",unCheckedChildren:"开"})))))))))}}]),a}(x.Component);ne=$([Object(R.connect)(function(e){var t,a=e.connection,n=e.loading,l=(e.total,e.user);return{listBasicList:a.list,loading:n.models.connection,fetchLoading:n.effects["connection/fetch"],deletable:null===(t=l.currentUser)||void 0===t?void 0:t.deletable}})],ne),t.default=Y.a.create()(ne)}}]);