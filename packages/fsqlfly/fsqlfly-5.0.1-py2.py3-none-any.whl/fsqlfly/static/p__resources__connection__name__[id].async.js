(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{t1GQ:function(e,t,a){"use strict";a.r(t);a("Mwp2");var n=a("VXEj"),c=(a("IzEo"),a("bx4M")),r=(a("BoS7"),a("Sdc0")),l=(a("jCWc"),a("kPKH")),i=(a("14J3"),a("BMrR")),o=(a("MXD1"),a("CFYs")),s=(a("+BJd"),a("mr32")),u=(a("2qtc"),a("kLXV")),d=(a("+L6B"),a("2/Rp")),m=(a("5Dmo"),a("3S7+")),f=(a("lUTK"),a("BvKs")),p=(a("qVdP"),a("jsC+")),h=a("p0pE"),b=a.n(h),g=a("2Taf"),E=a.n(g),y=a("vZ4D"),v=a.n(y),C=a("MhPg"),k=a.n(C),S=a("l4Ni"),D=a.n(S),w=a("ujKo"),M=a.n(w),O=(a("5NDa"),a("5rEg")),N=a("q1tI"),x=a.n(N),I=a("i8i4"),L=a("wd/R"),j=a.n(L),B=a("MuoO"),R=a("8Skl"),V=a("rLCj"),F=a("xvlK"),P=a("WsrF"),T=(a("XlDN"),a("WnL9")),Y=a("Hx5s"),A=a("c+yx"),K=a("xM2q"),q=a("4NGg"),H=a.n(q),W=a("55Ip"),J=a("lc5D"),X=a.n(J);a("xWKc");function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var a,n=M()(e);if(t){var c=M()(this).constructor;a=Reflect.construct(n,arguments,c)}else a=n.apply(this,arguments);return D()(this,a)}}var G=function(e,t,a,n){var c,r=arguments.length,l=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,n);else for(var i=e.length-1;i>=0;i--)(c=e[i])&&(l=(r<3?c(l):r>3?c(t,a,l):c(t,a))||l);return r>3&&l&&Object.defineProperty(t,a,l),l},U=P.a.Item,Q=O.a.Search,Z="name",$=function(e){k()(a,e);var t=z(a);function a(){var e;return E()(this,a),(e=t.apply(this,arguments)).state={visible:!1,runVisible:!1,runDone:!1,done:!1,current:void 0,search:"",msg:"",success:!1,submitted:!1,config:"",type:""},e.formLayout={labelCol:{span:5},wrapperCol:{span:17}},e.getCurrentConnectionId=function(){return e.props.match.params.id},e.doRefresh=function(){e.setState({chooseDatabase:void 0}),(0,e.props.dispatch)({type:"".concat(Z,"/fetch"),payload:{connection_id:e.getCurrentConnectionId()}})},e.showModal=function(){e.setState({visible:!0,submitted:!1,current:{},config:""})},e.showEditModal=function(t){e.setState({visible:!0,current:t,submitted:!1,config:t.config})},e.showManageModal=function(t,a){e.setState({runVisible:!0,runDone:!1,msg:""}),(0,e.props.dispatch)({type:"".concat(Z,"/run"),payload:{method:a,model:Z,id:t.id},callback:function(t){e.setState({msg:t.msg,runDone:!0,success:t.success})}})},e.handleDone=function(){setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),e.setState({done:!1,visible:!1})},e.handleCancel=function(){setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),e.setState({visible:!1})},e.handleSubmit=function(t){t.preventDefault();var a,n=e.props,c=n.dispatch,r=n.form,l=n.connections,i=e.state.current,o=e.getCurrentConnectionId(),s=l.filter(function(e){return e.id==o});a=1!==s.length?"dev":s[0].name,setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),r.validateFields(function(t,n){if(!t){e.setState({submitted:!0});var r=void 0===n.database?"".concat(a,".").concat(n.name):"".concat(a,".").concat(n.database,".").concat(n.name);c({type:"".concat(Z,"/submit"),payload:b()({},i,n,{fullName:r,connectionId:e.getCurrentConnectionId()}),callback:function(t){t.success?e.setState({done:!0,success:t.success,msg:t.msg}):e.setState({runDone:!0,success:t.success,msg:t.msg,submitted:!1,runVisible:!0})}})}})},e.deleteItem=function(t){(0,e.props.dispatch)({type:"".concat(Z,"/submit"),payload:{id:t}})},e.onSearch=function(t,a){e.setState({search:t})},e.getFilterPageData=function(){var t=e.state,a=t.search,n=t.chooseDatabase,c=e.props.listBasicList,r=c.filter(function(e){return void 0===n||e.database===n}).filter(function(e){return 0===a.length||e.name.indexOf(a)>=0||e.fullName.indexOf(a)>=0});return r},e.getDatabaseFilter=function(){var t=e.props.listBasicList,a=void 0===t?[]:t,n=Array.from(new Set(a.filter(function(e){return null!==e.database}).map(function(e){return e.database})));return 0===n.length||0===a.length?x.a.createElement(x.a.Fragment,null):x.a.createElement(p.a,{className:H.a.namespaceButton,overlay:x.a.createElement(f.a,{onClick:function(t){var a=t.key;return e.setState({chooseDatabase:a})}},Array.isArray(n)&&n.map(function(e){return x.a.createElement(f.a.Item,{key:e},x.a.createElement(m.a,{title:e,placement:"left"},x.a.createElement("span",null,Object(A.c)(e))))}))},x.a.createElement(d.a,null,"数据库",x.a.createElement(R.a,null)))},e}return v()(a,[{key:"componentDidMount",value:function(){this.doRefresh()}},{key:"render",value:function(){var e,t=this,a=this.props.loading,h=this.props,g=h.form.getFieldDecorator,E=h.fetchLoading,y=h.match.params.id,v=this.state,C=v.visible,k=v.done,S=v.current,D=void 0===S?{}:S,w=v.search,M=v.success,N=v.msg,L=v.submitted,B=k?{footer:null,onCancel:this.handleDone}:{okText:"保存",onOk:this.handleSubmit,onCancel:this.handleCancel,footer:[x.a.createElement(d.a,{key:"back",onClick:this.handleCancel},"取消"),x.a.createElement(d.a,{key:"submit",type:"primary",loading:L,onClick:this.handleSubmit},"保存")]},q=x.a.createElement("div",{className:H.a.extraContent},x.a.createElement(d.a,{onClick:this.doRefresh,disabled:E},x.a.createElement(V.a,null)),this.getDatabaseFilter(),x.a.createElement(Q,{defaultValue:w,className:H.a.extraContentSearch,placeholder:"请输入",onSearch:this.onSearch})),J=function(e){var t=e.data,a=(t.name,t.database),n=t.isLatest,c=t.isLocked,r=t.createAt,l=t.updateAt;return x.a.createElement("div",{className:H.a.listContent},x.a.createElement("div",{className:H.a.listContentItem},x.a.createElement("p",null,x.a.createElement(s.a,null,a))),x.a.createElement("div",{className:H.a.listContentItem},x.a.createElement("span",null,"创建时间"),x.a.createElement("p",null,j()(r).format("YYYY-MM-DD HH:mm"))),x.a.createElement("div",{className:H.a.listContentItem},x.a.createElement("span",null,"修改时间"),x.a.createElement("p",null,j()(l).format("YYYY-MM-DD HH:mm"))),x.a.createElement("div",{className:H.a.listContentItem},x.a.createElement(o.a,{type:"circle",percent:100,status:Object(A.d)(n,c),strokeWidth:1,width:50,style:{width:180}})))},z=this.props.deletable,G=function(e){var a=e.item;return x.a.createElement(p.a,{overlay:x.a.createElement(f.a,{onClick:function(e){return function(e,a){"edit"===e?t.showEditModal(a):"update"==e?t.showManageModal(a,"update"):"clean"==e?t.showManageModal(a,"clean"):"upgrade"==e?t.showManageModal(a,"upgrade"):"delete"===e&&u.a.confirm({title:"删除",content:"确定删除吗？",okText:"确认",cancelText:"取消",onOk:function(){return t.deleteItem(a.id)}})}(e.key,a)}},z&&x.a.createElement(f.a.Item,{key:"delete"},"删除"),x.a.createElement(f.a.Item,{key:"update"},"更新"),x.a.createElement(f.a.Item,{key:"clean"},"清除"))},x.a.createElement("a",null,"更多 ",x.a.createElement(R.a,null)))};return x.a.createElement(x.a.Fragment,null,x.a.createElement(Y.b,null,x.a.createElement("div",{className:H.a.standardList},x.a.createElement(c.a,{className:H.a.listCard,bordered:!1,title:"列表",style:{marginTop:24},bodyStyle:{padding:"0 32px 40px 32px"},extra:q},x.a.createElement(d.a,{type:"dashed",style:{width:"100%",marginBottom:8},icon:x.a.createElement(F.a,null),onClick:this.showModal,ref:function(e){t.addBtn=Object(I.findDOMNode)(e)}},"添加"),x.a.createElement(n.b,{pagination:{position:"bottom"},size:"large",rowKey:"id",loading:a,dataSource:this.getFilterPageData(),renderItem:function(e){return x.a.createElement(n.b.Item,{actions:[x.a.createElement("a",{key:"edit",onClick:function(a){a.preventDefault(),t.showEditModal(e)}},"编辑"),x.a.createElement(W.Link,{to:"/resources/connection/name/".concat(y,"/template/").concat(e.id)},"模板"),x.a.createElement(G,{key:"more",item:e})]},x.a.createElement(n.b.Item.Meta,{title:x.a.createElement(m.a,{title:e.fullName,placement:"left"},x.a.createElement("a",{href:"#"},Object(A.c)(e.name))),description:x.a.createElement(m.a,{title:e.info,placement:"left"},x.a.createElement("a",{href:"#"},Object(A.c)(e.info)))}),x.a.createElement(J,{data:e}))}}))),x.a.createElement(u.a,{title:"运行结果",className:H.a.standardListForm,width:1080,bodyStyle:{padding:"72px 0"},destroyOnClose:!0,visible:this.state.runVisible,onCancel:function(e){return t.setState({runVisible:!1})},footer:null,confirmLoading:this.state.done},x.a.createElement(T.a,{type:this.state.runDone?this.state.success?"success":"error":"line",title:this.state.runDone?this.state.success?"运行成功":"运行失败":"提交中...",description:this.state.msg,actions:x.a.createElement(d.a,{loading:!this.state.runDone,type:"primary",onClick:function(e){return t.setState({runVisible:!1})}},"知道了"),className:H.a.formResult}))),x.a.createElement(u.a,Object.assign({title:k?null:"".concat(void 0!==D.id?"编辑":"新增"),className:H.a.standardListForm,width:1080,bodyStyle:k?{padding:"72px 0"}:{padding:"28px 0 0"},destroyOnClose:!0,visible:C},B),(e=void 0===D.id,k?x.a.createElement(T.a,{type:M?"success":"error",title:"操作 ".concat(M?"成功":"失败"),description:M?"":N,actions:x.a.createElement(d.a,{type:"primary",onClick:t.handleDone},"知道了"),className:H.a.formResult}):x.a.createElement(P.a,{onSubmit:t.handleSubmit},x.a.createElement(U,Object.assign({label:"名称"},t.formLayout),g("name",{rules:e?K.a:[],initialValue:D.name})(x.a.createElement(O.a,{disabled:!e,placeholder:"请输入"}))),x.a.createElement(U,Object.assign({label:"介绍"},t.formLayout),g("info",{initialValue:D.info,rules:[{required:!1}]})(x.a.createElement(O.a.TextArea,{placeholder:"简介"}))),x.a.createElement(U,Object.assign({label:"数据库"},t.formLayout),g("database",{initialValue:D.database,rules:[{required:!1}]})(x.a.createElement(O.a,{disabled:!e,placeholder:"数据库名"}))),x.a.createElement(U,Object.assign({label:"config"},t.formLayout),x.a.createElement(X.a,{mode:"ini",onChange:function(e){return t.setState({config:e,current:b()({},D,{config:e})})},name:"functionConstructorConfig",editorProps:{$blockScrolling:!0},readOnly:!1,placeholder:"请输入Yaml配置",defaultValue:D.config,value:null!==t.state.config?t.state.config:"",width:765,height:230})),x.a.createElement(U,Object.assign({label:"其他"},t.formLayout),x.a.createElement(i.a,{gutter:16},x.a.createElement(l.a,{span:3},g("isActive",{initialValue:D.isActive,valuePropName:"checked"})(x.a.createElement(r.a,{checkedChildren:"激活",unCheckedChildren:"禁用"})))))))))}}]),a}(N.Component);$=G([Object(B.connect)(function(e){var t,a=e.name,n=e.loading,c=(e.total,e.user);return{listBasicList:a.list,connections:a.dependence,loading:n.models.name,fetchLoading:n.effects["name/fetch"],deletable:null===(t=c.currentUser)||void 0===t?void 0:t.deletable}})],$),t.default=P.a.create()($)}}]);