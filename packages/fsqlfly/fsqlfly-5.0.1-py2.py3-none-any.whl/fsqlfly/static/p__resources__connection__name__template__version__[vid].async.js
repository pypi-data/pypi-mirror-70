(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{VyxZ:function(e,t,a){"use strict";a.r(t);a("bbsP");var n=a("/wGt"),r=(a("5Dmo"),a("3S7+")),i=(a("Mwp2"),a("VXEj")),l=(a("IzEo"),a("bx4M")),c=(a("BoS7"),a("Sdc0")),o=(a("jCWc"),a("kPKH")),s=(a("14J3"),a("BMrR")),d=(a("lUTK"),a("BvKs")),u=(a("qVdP"),a("jsC+")),m=(a("MXD1"),a("CFYs")),f=(a("+BJd"),a("mr32")),p=(a("+L6B"),a("2/Rp")),h=(a("2qtc"),a("kLXV")),g=a("p0pE"),v=a.n(g),b=a("qIgq"),y=a.n(b),E=a("2Taf"),C=a.n(E),k=a("vZ4D"),S=a.n(k),I=a("MhPg"),N=a.n(I),w=a("l4Ni"),D=a.n(w),M=a("ujKo"),x=a.n(M),O=(a("5NDa"),a("5rEg")),V=a("q1tI"),L=a.n(V),j=a("i8i4"),R=a("wd/R"),B=a.n(R),T=a("MuoO"),F=a("rLCj"),P=a("8Skl"),Y=a("xvlK"),q=a("WsrF"),K=(a("XlDN"),a("WnL9")),H=a("Hx5s"),A=a("c+yx"),W=a("xM2q"),J=a("4NGg"),X=a.n(J),_=a("lc5D"),z=a.n(_);a("KWgm");function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var a,n=x()(e);if(t){var r=x()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return D()(this,a)}}var U=function(e,t,a,n){var r,i=arguments.length,l=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(l=(i<3?r(l):i>3?r(t,a,l):r(t,a))||l);return i>3&&l&&Object.defineProperty(t,a,l),l},Z=q.a.Item,$=O.a.Search,Q="version",ee=function(e){N()(a,e);var t=G(a);function a(){var e;return C()(this,a),(e=t.apply(this,arguments)).state={visible:!1,cacheVisible:!1,runVisible:!1,runDone:!1,done:!1,current:void 0,search:"",msg:"",success:!1,submitted:!1,config:"",type:""},e.formLayout={labelCol:{span:5},wrapperCol:{span:17}},e.getCurrentConnectionId=function(){var t=e.props.match.params.id;return parseInt(t)},e.getCurrentConnectionType=function(){var t=e.props.connections,a=e.getCurrentConnectionId(),n=t.filter(function(e){return e.id===a});return n.length>=1?n[0].type:"unknown"},e.getCurrentNameId=function(){var t=e.props.match.params.nid;return parseInt(t)},e.getTemplateId=function(){var t=e.props.match.params.vid;return parseInt(t)},e.getFullName=function(t){var a=e.props.templates,n=e.getTemplateId(),r=a.filter(function(e){return e.id===n}),i=y()(r,1)[0];return(void 0===i?{fullName:"devTemplateFullName"}:i).fullName+"."+t},e.getMaxVersion=function(){var t=0;return e.props.listBasicList.forEach(function(e){t=Math.max(e.version,t)}),t},e.doRefresh=function(){(0,e.props.dispatch)({type:"".concat(Q,"/fetch"),payload:{connection_id:e.getCurrentConnectionId(),resource_name_id:e.getCurrentNameId(),template_id:e.getTemplateId()}})},e.showModal=function(){e.setState({visible:!0,submitted:!1,current:{},config:""})},e.showEditModal=function(t){e.setState({visible:!0,current:t,submitted:!1,config:void 0===t.config?"":t.config})},e.showCopyCreateModal=function(t){var a=v()({},t);delete a.id,delete a.createAt,delete a.updateAt,a.isSystem=!1,e.setState({visible:!0,current:a,submitted:!1,config:void 0===t.config||null===t.config?"":t.config})},e.showManageModal=function(t,a){e.setState({runVisible:!0,runDone:!1,msg:""}),(0,e.props.dispatch)({type:"".concat(Q,"/run"),payload:{method:a,model:Q,id:t.id},callback:function(t){e.setState({msg:t.msg,runDone:!0,success:t.success}),e.doRefresh()}})},e.handleDone=function(){setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),e.setState({done:!1,visible:!1})},e.handleCancel=function(){setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),e.setState({visible:!1})},e.handleSubmit=function(t){t.preventDefault();var a=e.props,n=a.dispatch,r=a.form,i=e.state.current,l=void 0!==(null===i||void 0===i?void 0:i.id)&&null!==i.id;setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),r.validateFields(function(t,a){if(!t){e.setState({submitted:!0});var r=l?null===i||void 0===i?void 0:i.fullName:e.getFullName(a.name);void 0!==(null===i||void 0===i?void 0:i.id)&&null!==(null===i||void 0===i?void 0:i.id)||(a.version=e.getMaxVersion()+1),n({type:"".concat(Q,"/submit"),payload:v()({},i,a,{fullName:r,connectionId:e.getCurrentConnectionId(),resourceNameId:e.getCurrentNameId(),templateId:e.getTemplateId()}),callback:function(t){t.success?e.setState({done:!0,success:t.success,msg:t.msg}):e.setState({runDone:!0,success:t.success,msg:t.msg,submitted:!1,runVisible:!0})}})}})},e.deleteItem=function(t){(0,e.props.dispatch)({type:"".concat(Q,"/submit"),payload:{id:t}})},e.onSearch=function(t,a){e.setState({search:t})},e.getFilterPageData=function(){var t=e.state.search,a=e.props.listBasicList,n=a.filter(function(e){return 0===t.length||e.fullName.indexOf(t)>=0||(void 0!==e.name&&null!==e.name?e.name.indexOf(t)>0:e.version.toString().indexOf(t)>0)});return n},e}return S()(a,[{key:"componentDidMount",value:function(){this.doRefresh()}},{key:"render",value:function(){var e,t=this,a=this.props.loading,g=this.props,b=g.form.getFieldDecorator,y=g.fetchLoading,E=this.state,C=E.visible,k=E.done,S=E.current,I=void 0===S?{}:S,N=E.search,w=E.success,D=E.msg,M=E.submitted,x=k?{footer:null,onCancel:this.handleDone}:{okText:"保存",onOk:this.handleSubmit,onCancel:this.handleCancel,footer:[L.a.createElement(p.a,{key:"back",onClick:this.handleCancel},"取消"),L.a.createElement(p.a,{key:"submit",type:"primary",loading:M,onClick:this.handleSubmit},"保存")]},V=L.a.createElement("div",{className:X.a.extraContent},L.a.createElement(p.a,{onClick:this.doRefresh,disabled:y},L.a.createElement(F.a,null)),L.a.createElement($,{defaultValue:N,className:X.a.extraContentSearch,placeholder:"请输入",onSearch:this.onSearch})),R=function(e){var t=e.data,a=t.version,n=t.isDefault,r=(t.isSystem,t.isLocked),i=t.createAt,l=t.updateAt;return L.a.createElement("div",{className:X.a.listContent},L.a.createElement("div",{className:X.a.listContentItem},L.a.createElement("p",null,L.a.createElement(f.a,null,"V",a))),L.a.createElement("div",{className:X.a.listContentItem},L.a.createElement("span",null,"创建时间"),L.a.createElement("p",null,B()(i).format("YYYY-MM-DD HH:mm"))),L.a.createElement("div",{className:X.a.listContentItem},L.a.createElement("span",null,"修改时间"),L.a.createElement("p",null,B()(l).format("YYYY-MM-DD HH:mm"))),L.a.createElement("div",{className:X.a.listContentItem},L.a.createElement(m.a,{type:"circle",percent:100,status:Object(A.d)(n,r),strokeWidth:1,width:50,style:{width:180}})))},T=this.props.deletable,J=function(e){var a=e.item;return L.a.createElement(u.a,{overlay:L.a.createElement(d.a,{onClick:function(e){return function(e,a){"edit"===e?t.showEditModal(a):"update"==e?t.showManageModal(a,"update"):"copy"==e?t.showCopyCreateModal(a):"show"==e?t.setState({cacheVisible:!0,current:a}):"upgrade"==e?t.showManageModal(a,"upgrade"):"delete"===e&&h.a.confirm({title:"删除",content:"确定删除吗？",okText:"确认",cancelText:"取消",onOk:function(){return t.deleteItem(a.id)}})}(e.key,a)}},T&&L.a.createElement(d.a.Item,{key:"delete"},"删除"),L.a.createElement(d.a.Item,{key:"update"},"更新"),L.a.createElement(d.a.Item,{key:"show"},"显示缓存"),L.a.createElement(d.a.Item,{key:"copy"},"复制"))},L.a.createElement("a",null,"更多 ",L.a.createElement(P.a,null)))};return L.a.createElement(L.a.Fragment,null,L.a.createElement(H.b,null,L.a.createElement("div",{className:X.a.standardList},L.a.createElement(l.a,{className:X.a.listCard,bordered:!1,title:"列表",style:{marginTop:24},bodyStyle:{padding:"0 32px 40px 32px"},extra:V},L.a.createElement(p.a,{type:"dashed",style:{width:"100%",marginBottom:8},icon:L.a.createElement(Y.a,null),onClick:this.showModal,ref:function(e){t.addBtn=Object(j.findDOMNode)(e)}},"添加"),L.a.createElement(i.b,{size:"large",rowKey:"id",loading:a,dataSource:this.getFilterPageData(),renderItem:function(e){return L.a.createElement(i.b.Item,{actions:[L.a.createElement("a",{key:"edit",onClick:function(a){a.preventDefault(),t.showEditModal(e)}},"编辑"),L.a.createElement(J,{key:"more",item:e})]},L.a.createElement(i.b.Item.Meta,{title:L.a.createElement(r.a,{title:e.fullName,placement:"left"},L.a.createElement("a",{href:"#"},Object(A.c)(e.name))),description:L.a.createElement(r.a,{title:e.info,placement:"left"},L.a.createElement("a",{href:"#"},Object(A.c)(e.info)))}),L.a.createElement(R,{data:e}))}}))),L.a.createElement(h.a,{title:"运行结果",className:X.a.standardListForm,width:1080,bodyStyle:{padding:"72px 0"},destroyOnClose:!0,visible:this.state.runVisible,onCancel:function(e){return t.setState({runVisible:!1})},footer:null,confirmLoading:this.state.done},L.a.createElement(K.a,{type:this.state.runDone?this.state.success?"success":"error":"line",title:this.state.runDone?this.state.success?"运行成功":"运行失败":"提交中...",description:this.state.msg,actions:L.a.createElement(p.a,{loading:!this.state.runDone,type:"primary",onClick:function(e){return t.setState({runVisible:!1})}},"知道了"),className:X.a.formResult}))),L.a.createElement(h.a,Object.assign({title:k?null:"".concat(void 0!==I.id?"编辑":"新增"),className:X.a.standardListForm,width:1080,bodyStyle:k?{padding:"72px 0"}:{padding:"28px 0 0"},destroyOnClose:!0,visible:C},x),(e=void 0===I.id,k?L.a.createElement(K.a,{type:w?"success":"error",title:"操作 ".concat(w?"成功":"失败"),description:w?"":D,actions:L.a.createElement(p.a,{type:"primary",onClick:t.handleDone},"知道了"),className:X.a.formResult}):L.a.createElement(q.a,{onSubmit:t.handleSubmit},L.a.createElement(Z,Object.assign({label:"名称"},t.formLayout),b("name",{rules:e?W.a:[],initialValue:I.name})(L.a.createElement(O.a,{disabled:!e,placeholder:"请输入"}))),L.a.createElement(Z,Object.assign({label:"介绍"},t.formLayout),b("info",{initialValue:I.info,rules:[{required:!1}]})(L.a.createElement(O.a.TextArea,{placeholder:"简介"}))),L.a.createElement(Z,Object.assign({label:"config"},t.formLayout),L.a.createElement(z.a,{mode:"yaml",onChange:function(e){return t.setState({config:e,current:v()({},I,{config:e})})},name:"functionConstructorConfig",editorProps:{$blockScrolling:!0},readOnly:!1,placeholder:"请输入Yaml配置",defaultValue:null===I.config?"":I.config,value:null===t.state.config?"":t.state.config,width:765,height:230})),L.a.createElement(Z,Object.assign({label:"其他"},t.formLayout),L.a.createElement(s.a,{gutter:16},L.a.createElement(o.a,{span:3},b("isDefault",{initialValue:I.isDefault,valuePropName:"checked"})(L.a.createElement(c.a,{checkedChildren:"默认",unCheckedChildren:"取消"}))),L.a.createElement(o.a,{span:3},b("isLocked",{initialValue:I.isLocked,valuePropName:"checked"})(L.a.createElement(c.a,{checkedChildren:"锁",unCheckedChildren:"开"})))))))),L.a.createElement(n.a,{title:void 0===I.name||null!==I.name?I.name:"",placement:"right",onClose:function(e){return t.setState({cacheVisible:!1})},visible:this.state.cacheVisible,width:800},L.a.createElement(z.a,{mode:"yaml",name:"cacheName",readOnly:!0,value:null!==I.cache?I.cache:"",width:800,height:980})))}}]),a}(V.Component);ee=U([Object(T.connect)(function(e){var t,a=e.version,n=e.loading,r=(e.total,e.user);return{listBasicList:a.list,connections:a.dependence,names:a.dependence1,templates:a.dependence2,loading:n.models.version,fetchLoading:n.effects["version/fetch"],deletable:null===(t=r.currentUser)||void 0===t?void 0:t.deletable}})],ee),t.default=q.a.create()(ee)}}]);