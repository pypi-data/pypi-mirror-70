(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{YqIF:function(e,t){ace.define("ace/theme/github",["require","exports","module","ace/lib/dom"],function(e,t,a){t.isDark=!1,t.cssClass="ace-github",t.cssText='.ace-github .ace_gutter {background: #e8e8e8;color: #AAA;}.ace-github  {background: #fff;color: #000;}.ace-github .ace_keyword {font-weight: bold;}.ace-github .ace_string {color: #D14;}.ace-github .ace_variable.ace_class {color: teal;}.ace-github .ace_constant.ace_numeric {color: #099;}.ace-github .ace_constant.ace_buildin {color: #0086B3;}.ace-github .ace_support.ace_function {color: #0086B3;}.ace-github .ace_comment {color: #998;font-style: italic;}.ace-github .ace_variable.ace_language  {color: #0086B3;}.ace-github .ace_paren {font-weight: bold;}.ace-github .ace_boolean {font-weight: bold;}.ace-github .ace_string.ace_regexp {color: #009926;font-weight: normal;}.ace-github .ace_variable.ace_instance {color: teal;}.ace-github .ace_constant.ace_language {font-weight: bold;}.ace-github .ace_cursor {color: black;}.ace-github.ace_focus .ace_marker-layer .ace_active-line {background: rgb(255, 255, 204);}.ace-github .ace_marker-layer .ace_active-line {background: rgb(245, 245, 245);}.ace-github .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-github.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-github.ace_nobold .ace_line > span {font-weight: normal !important;}.ace-github .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-github .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-github .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-github .ace_gutter-active-line {background-color : rgba(0, 0, 0, 0.07);}.ace-github .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-github .ace_invisible {color: #BFBFBF}.ace-github .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-github .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}',e("../lib/dom").importCssString(t.cssText,t.cssClass)})},oQQD:function(e,t,a){"use strict";a.r(t);a("BoS7");var n=a("Sdc0"),r=(a("jCWc"),a("kPKH")),c=(a("14J3"),a("BMrR")),l=(a("Mwp2"),a("VXEj")),i=(a("IzEo"),a("bx4M")),o=(a("MXD1"),a("CFYs")),s=(a("7Kak"),a("9yH6")),u=(a("2qtc"),a("kLXV")),m=(a("+L6B"),a("2/Rp")),d=(a("lUTK"),a("BvKs")),h=(a("qVdP"),a("jsC+")),g=(a("Telt"),a("Tckk")),p=(a("+BJd"),a("mr32")),b=(a("5Dmo"),a("3S7+")),f=a("p0pE"),E=a.n(f),y=a("2Taf"),v=a.n(y),k=a("vZ4D"),C=a.n(k),S=a("MhPg"),_=a.n(S),w=a("l4Ni"),A=a.n(w),I=a("ujKo"),N=a.n(I),x=(a("OaEy"),a("2fM7")),D=(a("5NDa"),a("5rEg")),O=a("q1tI"),B=a.n(O),q=a("wd/R"),V=a.n(q),L=a("MuoO"),j=a("8Skl"),M=a("xvlK"),T=a("WsrF"),R=(a("XlDN"),a("rLCj")),F=a("P5Jw"),Y=a("4NGg"),P=a.n(Y),K=a("i8i4"),J=a("WnL9"),H=a("xM2q"),W=a("lc5D"),z=a.n(W),Q=(a("KWgm"),a("bHNl"),a("YqIF"),a("whJP")),U=a("c+yx");function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var a,n=N()(e);if(t){var r=N()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return A()(this,a)}}var G=D.a.Search,Z=x.a.Option,$="transform",ee=function(e){_()(a,e);var t=X(a);function a(){var e;return v()(this,a),(e=t.apply(this,arguments)).state={visible:!1,done:!1,current:{},search:"",msg:"",success:!1,submitted:!1,searchResult:[],tag:0,editVisible:!1,edithDone:!1,edithSubmit:!1,chooseConnectorId:null},e.formLayout={labelCol:{span:5},wrapperCol:{span:17}},e.normFile=function(e){return Array.isArray(e)?e:e&&e.fileList},e.doRefresh=function(){(0,e.props.dispatch)({type:"".concat($,"/fetch")})},e.showModal=function(){e.setState({editVisible:!0,current:{}})},e.showRunModal=function(t,a){e.setState({visible:!0,done:!1,msg:""}),(0,e.props.dispatch)({type:"transform/run",payload:E()({},t,{method:a,model:"transform"}),callback:function(t){e.setState({msg:t.msg,done:!0,success:t.success})}})},e.showDebugResult=function(){e.setState({edithSubmit:!0});var t=e.props,a=t.form,n=t.dispatch,r=e.state.current;a.validateFields(function(t,a){t?e.setState({edithSubmit:!1}):(e.setState({submitted:!0}),n({type:"transform/run",payload:E()({},a,r,{method:"debug",id:0,model:"transform"}),callback:function(t){e.setState({edithSubmit:!1}),t.success?window.open(t.data.url):e.setState({msg:t.msg,success:!1,done:!0,visible:!0})}}))})},e.showEditModal=function(t){e.setState({editVisible:!0,current:t,submitted:!1,edithSubmit:!1})},e.handleDone=function(){setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),e.setState({done:!1,visible:!1})},e.handleCancel=function(){setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),e.setState({editVisible:!1})},e.handleSubmit=function(){var t=e.props,a=t.form,n=t.dispatch,r=e.state.current;e.setState({visible:!0,done:!1,msg:"..."}),a.validateFields(function(t,a){t||(e.setState({submitted:!0}),n({type:"transform/submit",payload:E()({},r,a),callback:function(t){t.success?e.setState({edithDone:!1,editVisible:!1,success:t.success,msg:t.msg,visible:!1,edithSubmit:!1}):e.setState({done:!0,visible:!0,success:t.success,msg:t.msg,edithSubmit:!1})}}))})},e.handleChange=function(t){var a=e.state.current,n=t.join(","),r=void 0===a?{require:n}:E()({},a,{require:n});e.setState({current:r})},e.deleteItem=function(t){(0,e.props.dispatch)({type:"transform/submit",payload:{id:t}})},e.getNamespace=function(t){if(void 0===t)return null;var a=e.props.namespaces.filter(function(e){return e.id===t});return 0===a.length?null:a[0]},e.getNamespaceTitle=function(t){var a=e.getNamespace(t);return null===a?"":a.name},e.getNameTag=function(t){var a=e.getNamespaceTitle(t);return B.a.createElement(b.a,{title:a},B.a.createElement("div",null,B.a.createElement(p.a,null,Object(U.c)(a))))},e.setTagValue=function(t){e.setState({tag:t,chooseConnectorId:null})},e.getNamespaceAvatar=function(t){var a=e.getNamespace(t.namespaceId);return null===a?B.a.createElement(g.a,{alt:t.info,shape:"square",size:"large"},"DEFAULT"):B.a.createElement(g.a,{src:a.avatar,alt:t.info,shape:"square",size:"large"},void 0===a.avatar||null===a.avatar?a.name:"")},e.getConnectorFilter=function(){var t=e.props,a=t.connectors,n=void 0===a?[]:a,r=t.listBasicList,c=void 0===r?[]:r,l=Array.from(new Set(c.filter(function(e){return null!==e.connectorId}).map(function(e){return n.filter(function(t){return t.id===e.connectorId})[0]})));return 0===l.length||0===c.length||0===n.length?B.a.createElement(B.a.Fragment,null):B.a.createElement(h.a,{className:P.a.namespaceButton,overlay:B.a.createElement(d.a,{onClick:function(t){var a=t.key;return e.setState({chooseConnectorId:parseInt(a)})}},Array.isArray(l)&&l.map(function(e){return B.a.createElement(d.a.Item,{key:e.id},B.a.createElement(b.a,{title:e.info,placement:"left"},B.a.createElement("span",null,Object(U.c)(e.name))))}))},B.a.createElement(m.a,null,"连接器",B.a.createElement(j.a,null)))},e}return C()(a,[{key:"componentDidMount",value:function(){this.doRefresh()}},{key:"render",value:function(){var e=this,t=this.props,a=t.loading,g=t.namespaces,p=this.state,f=p.search,y=p.current,v=void 0===y?{}:y,k=p.edithSubmit,C=this.props.listBasicList,S=s.a.Group,_=s.a.Button,w=B.a.createElement("div",{className:P.a.extraContent},B.a.createElement(m.a,{onClick:this.doRefresh},B.a.createElement(R.a,null)),B.a.createElement(S,{defaultValue:null,onChange:function(t){return e.setTagValue(t.target.value)}},B.a.createElement(_,{className:P.a.namespaceButton,value:0},"全部"),g.length>0&&g.slice(0,8).map(function(e){return B.a.createElement(b.a,{title:e.name,placement:"left"},B.a.createElement(_,{className:P.a.namespaceButton,key:e.id,value:e.id},Object(U.c)(e.name)))}),g.length>8&&B.a.createElement(h.a,{className:P.a.namespaceButton,overlay:B.a.createElement(d.a,{onClick:function(t){var a=t.key;return e.setTagValue(parseInt(a))}},g.slice(8,g.length+1).map(function(e){return B.a.createElement(d.a.Item,{key:e.id},B.a.createElement(b.a,{title:e.name,placement:"left"},B.a.createElement("span",null,Object(U.c)(e.name))))}))},B.a.createElement(m.a,null,"更多",B.a.createElement(j.a,null))),this.getConnectorFilter()),B.a.createElement(G,{defaultValue:f,className:P.a.extraContentSearch,placeholder:"请输入项目名或者命名空间搜索",onSearch:function(t){return e.setState({search:t})}})),A=function(t){var a=t.data,n=(a.name,a.info,a.isDaemon),r=a.createAt,c=a.updateAt,l=a.namespaceId;return B.a.createElement("div",{className:P.a.listContent},B.a.createElement("div",{className:P.a.listContentItem},e.getNameTag(l)),B.a.createElement("div",{className:P.a.listContentItem},B.a.createElement("span",null,"创建时间"),B.a.createElement("p",null,V()(r).format("YYYY-MM-DD HH:mm"))),B.a.createElement("div",{className:P.a.listContentItem},B.a.createElement("span",null,"修改时间"),B.a.createElement("p",null,V()(c).format("YYYY-MM-DD HH:mm"))),B.a.createElement("div",{className:P.a.listContentItem},B.a.createElement(o.a,{type:"circle",percent:100,status:n?"success":"normal",strokeWidth:1,width:50,style:{width:180}})))},I=function(t){var a=t.item;return B.a.createElement(h.a,{overlay:B.a.createElement(d.a,{onClick:function(t){return function(t,a){"start"===t||"stop"===t||"restart"===t?e.showRunModal(a,t):"delete"===t&&u.a.confirm({title:"删除任务",content:"确定删除该任务吗？",okText:"确认",cancelText:"取消",onOk:function(){return e.deleteItem(void 0!==a.id?a.id:0)}})}(t.key,a)}},B.a.createElement(d.a.Item,{key:"delete"},"删除"),B.a.createElement(d.a.Item,{key:"start"},"运行"),B.a.createElement(d.a.Item,{key:"stop"},"停止"),B.a.createElement(d.a.Item,{key:"restart"},"重启"),B.a.createElement(d.a.Item,{key:"copy"},B.a.createElement(F.CopyToClipboard,{text:a.require,onCopy:function(){return e.setState({edithDone:!0})}},B.a.createElement("span",null,"复制依赖"))))},B.a.createElement("a",null,"更多 ",B.a.createElement(j.a,null)))},N=T.a.Item,O=x.a.Option,q={okText:"保存",onOk:this.handleSubmit,onCancel:this.handleCancel,footer:[B.a.createElement(m.a,{key:"back",onClick:this.handleCancel},"取消"),B.a.createElement(m.a,{key:"submit",type:"primary",loading:k,onClick:this.handleSubmit},"保存"),B.a.createElement(m.a,{type:"primary",onClick:function(t){return e.showDebugResult()},loading:k},"调试")]},L=this.props,Y=L.form.getFieldDecorator,W=L.resources,X=Array.isArray(W)?W.map(function(e){return B.a.createElement(Z,{key:e,title:e,value:e},e)}):[];return B.a.createElement(B.a.Fragment,null,B.a.createElement("div",{className:P.a.standardList},B.a.createElement(i.a,{className:P.a.listCard,bordered:!1,title:"资源",style:{marginTop:24},bodyStyle:{padding:"0 32px 40px 32px"},extra:w},B.a.createElement(m.a,{type:"dashed",style:{width:"100%",marginBottom:8},icon:B.a.createElement(M.a,null),onClick:this.showModal,ref:function(t){e.addBtn=Object(K.findDOMNode)(t)}},"添加"),B.a.createElement(l.b,{pagination:{position:"bottom"},size:"large",rowKey:"id",loading:a,dataSource:C.filter(function(t){return t.name.indexOf(f)>=0&&(0===e.state.tag||t.namespaceId===e.state.tag)&&t.connectorId===e.state.chooseConnectorId}),renderItem:function(t){return B.a.createElement(l.b.Item,{actions:[B.a.createElement("a",{key:"edit",onClick:function(a){a.preventDefault(),e.showEditModal(t)}},"编辑"),B.a.createElement(I,{key:"more",item:t})]},B.a.createElement(l.b.Item.Meta,{avatar:e.getNamespaceAvatar(t),title:B.a.createElement(b.a,{title:t.name},B.a.createElement("a",{href:"#"},Object(U.c)(t.name))),description:B.a.createElement(b.a,{title:t.info,placement:"right"},B.a.createElement("span",null,Object(U.c)(t.info)))}),B.a.createElement(A,{data:t}))}}))),B.a.createElement(u.a,{title:"运行结果",className:P.a.standardListForm,width:1080,bodyStyle:{padding:"72px 0"},destroyOnClose:!0,visible:this.state.visible,onCancel:function(t){return e.setState({visible:!1})},footer:null,confirmLoading:this.state.done},B.a.createElement(J.a,{type:this.state.done?this.state.success?"success":"error":"line",title:this.state.done?this.state.success?"运行成功":"运行失败":"提交中...",description:this.state.msg,actions:B.a.createElement(m.a,{loading:!this.state.done,type:"primary",onClick:function(t){return e.setState({visible:!1})}},"知道了"),className:P.a.formResult})),B.a.createElement(u.a,Object.assign({title:void 0===v?null:void 0===v.id?"新增":"编辑",className:P.a.standardListForm,width:1080,bodyStyle:{padding:"72px 0"},destroyOnClose:!0,visible:this.state.editVisible},q),B.a.createElement(T.a,{onSubmit:this.handleSubmit},B.a.createElement(N,Object.assign({label:"名称"},this.formLayout),Y("name",{rules:H.a,initialValue:void 0===v?"":v.name})(B.a.createElement(D.a,{placeholder:"请输入"}))),B.a.createElement(N,Object.assign({label:"介绍"},this.formLayout),Y("info",{initialValue:void 0===v?"":v.info})(B.a.createElement(Q.a,{placeholder:"请输入"}))),B.a.createElement(N,Object.assign({label:"依赖"},this.formLayout),B.a.createElement(x.a,{mode:"tags",onChange:this.handleChange,tokenSeparators:[","],defaultValue:void 0===v||null===v.require||void 0===v.require?void 0:v.require.split(",")},X)),B.a.createElement(N,Object.assign({label:"命名空间"},this.formLayout),Y("namespaceId",{initialValue:void 0===v||null===v.namespaceId?0:v.namespaceId,rules:[{required:!1}]})(B.a.createElement(x.a,null,B.a.createElement(O,{key:-1,value:0},"默认"),g.length>0&&g.map(function(e){return B.a.createElement(O,{key:e.id,value:e.id},e.name)})))),B.a.createElement(N,Object.assign({label:"SQL"},this.formLayout),B.a.createElement(z.a,{mode:"sql",theme:"github",onChange:function(t){return e.setState({current:E()({},v,{sql:t})})},name:"functionConstructorConfig",editorProps:{$blockScrolling:!0},readOnly:!1,placeholder:"请输入Yaml配置",defaultValue:void 0===v.sql||null===v.sql?"":v.sql,value:void 0===v.sql||null===v.sql?"":v.sql,width:765,height:650})),B.a.createElement(N,Object.assign({label:"配置文件"},this.formLayout),B.a.createElement(z.a,{mode:"yaml",theme:"solarized_dark",onChange:function(t){return e.setState({current:E()({},v,{yaml:t})})},name:"functionConstructorConfig",editorProps:{$blockScrolling:!0},readOnly:!1,placeholder:"请输入Yaml配置",defaultValue:null===v.yaml?"":v.yaml,value:void 0===v.yaml||null===v.yaml?"":v.yaml,width:765,height:650})),B.a.createElement(N,Object.assign({label:"其他"},this.formLayout),B.a.createElement(c.a,{gutter:16},B.a.createElement(r.a,{span:3},Y("isDaemon",{initialValue:void 0!==v&&v.isDaemon,valuePropName:"checked"})(B.a.createElement(n.a,{checkedChildren:"守护",unCheckedChildren:"禁止"}))))))))}}]),a}(O.Component),te=T.a.create()(ee);t.default=Object(L.connect)(function(e){var t=e.transform,a=e.loading;return{listBasicList:t.list,namespaces:t.dependence,connectors:t.dependence2,loading:a.models.transform,resources:t.dependence1}})(te)}}]);