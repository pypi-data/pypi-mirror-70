const Utils=$.fn.bootstrapTable.utils,UtilsFilterControl={getOptionsFromSelectControl(a){return a.get(a.length-1).options},getControlContainer(a){return a.options.filterControlContainer?$(`${a.options.filterControlContainer}`):UtilsFilterControl.getCurrentHeader(a)},getSearchControls(a){const b=UtilsFilterControl.getControlContainer(a),c=UtilsFilterControl.getCurrentSearchControls(a);return b.find(c)},hideUnusedSelectOptions(a,b){const c=UtilsFilterControl.getOptionsFromSelectControl(a);for(let d=0;d<c.length;d++)""!==c[d].value&&(b.hasOwnProperty(c[d].value)?a.find(Utils.sprintf("option[value='%s']",c[d].value)).show():a.find(Utils.sprintf("option[value='%s']",c[d].value)).hide())},addOptionToSelectControl(a,b,c,d){const e=$.trim(b),f=$(a.get(a.length-1));if(!UtilsFilterControl.existOptionInSelectControl(a,e)){const a=$(`<option value="${e}">${c}</option>`);e===d&&a.attr("selected",!0),f.append(a)}},sortSelectControl(a,c){const d=$(a.get(a.length-1)),e=d.find("option:gt(0)");"server"!==c&&e.sort((d,a)=>Utils.sort(d.textContent,a.textContent,"desc"===c?-1:1)),d.find("option:gt(0)").remove(),d.append(e)},existOptionInSelectControl(a,b){const c=UtilsFilterControl.getOptionsFromSelectControl(a);for(let d=0;d<c.length;d++)if(c[d].value===b.toString())return!0;return!1},fixHeaderCSS({$tableHeader:a}){a.css("height","77px")},getCurrentHeader({$header:a,options:b,$tableHeader:c}){let d=a;return b.height&&(d=c),d},getCurrentSearchControls({options:a}){let b="select, input";return a.height&&(b="table select, table input"),b},getCursorPosition(a){if(Utils.isIEBrowser()){if($(a).is("input[type=text]")){let b=0;if("selectionStart"in a)b=a.selectionStart;else if("selection"in document){a.focus();const c=document.selection.createRange(),d=document.selection.createRange().text.length;c.moveStart("character",-a.value.length),b=c.text.length-d}return b}return-1}return-1},setCursorPosition(a){$(a).val(a.value)},copyValues(a){const b=UtilsFilterControl.getSearchControls(a);a.options.valuesFilterControl=[],b.each(function(){a.options.valuesFilterControl.push({field:$(this).closest("[data-field]").data("field"),value:$(this).val(),position:UtilsFilterControl.getCursorPosition($(this).get(0)),hasFocus:$(this).is(":focus")})})},setValues(a){let b=null,c=[];const d=UtilsFilterControl.getSearchControls(a);if(0<a.options.valuesFilterControl.length){let e=null;d.each(function(){b=$(this).closest("[data-field]").data("field"),c=a.options.valuesFilterControl.filter(a=>a.field===b),0<c.length&&($(this).val(c[0].value),c[0].hasFocus&&""!==c[0].value&&(e=((a,b)=>{return()=>{a.focus(),UtilsFilterControl.setCursorPosition(a,b)}})($(this).get(0),c[0].position)))}),null!==e&&e()}},collectBootstrapCookies(){const a=[],b=document.cookie.match(/(?:bs.table.)(\w*)/g),c=localStorage;if(b&&$.each(b,(b,c)=>{let d=c;/./.test(d)&&(d=d.split(".").pop()),-1===$.inArray(d,a)&&a.push(d)}),c)for(let b,d=0;d<c.length;d++)b=c.key(d),/./.test(b)&&(b=b.split(".").pop()),a.includes(b)||a.push(b);return a},escapeID(a){return(a+"").replace(/([:.\[\],])/g,"\\$1")},isColumnSearchableViaSelect({filterControl:a,searchable:b}){return a&&"select"===a.toLowerCase()&&b},isFilterDataNotGiven({filterData:a}){return a===void 0||"column"===a.toLowerCase()},hasSelectControlElement(a){return a&&0<a.length},initFilterSelectControls(a){const b=a.data,c=a.options.pagination?"server"===a.options.sidePagination?a.pageTo:a.options.totalRows:a.pageTo;$.each(a.header.fields,(d,e)=>{const f=a.columns[a.fieldsColumnsIndex[e]],g=UtilsFilterControl.getControlContainer(a).find(`.bootstrap-table-filter-control-${UtilsFilterControl.escapeID(f.field)}`);if(UtilsFilterControl.isColumnSearchableViaSelect(f)&&UtilsFilterControl.isFilterDataNotGiven(f)&&UtilsFilterControl.hasSelectControlElement(g)){0===g.get(g.length-1).options.length&&UtilsFilterControl.addOptionToSelectControl(g,"",f.filterControlPlaceholder,f.filterDefault);const h={};for(let j,k=0;k<c;k++){j=b[k][e];const c=a.options.editable&&f.editable?f._formatter:a.header.formatters[d];let i=Utils.calculateObjectValue(a.header,c,[j,b[k],k],j);if(f.filterDataCollector&&(i=Utils.calculateObjectValue(a.header,f.filterDataCollector,[j,b[k],i],i)),f.searchFormatter&&(j=i),h[i]=j,"object"==typeof i&&null!==i){i.forEach(a=>{UtilsFilterControl.addOptionToSelectControl(g,a,a,f.filterDefault)});continue}for(const a in h)UtilsFilterControl.addOptionToSelectControl(g,h[a],a,f.filterDefault)}UtilsFilterControl.sortSelectControl(g,f.filterOrderBy),a.options.hideUnusedSelectOptions&&UtilsFilterControl.hideUnusedSelectOptions(g,h)}}),a.trigger("created-controls")},getFilterDataMethod(a,b){const c=Object.keys(a);for(let d=0;d<c.length;d++)if(c[d]===b)return a[b];return null},createControls(a,b){let c,d=!1;$.each(a.columns,(e,f)=>{if(c=[],!!f.visible){if(!f.filterControl&&!a.options.filterControlContainer)c.push("<div class=\"no-filter-control\"></div>");else if(a.options.filterControlContainer){const a=$(`.bootstrap-table-filter-control-${f.field}`),b=f.filterControlPlaceholder?f.filterControlPlaceholder:"";a.attr("placeholder",b),a.val(f.filterDefault),a.attr("data-field",f.field),d=!0}else{const b=f.filterControl.toLowerCase();c.push("<div class=\"filter-control\">"),d=!0,f.searchable&&a.options.filterTemplate[b]&&c.push(a.options.filterTemplate[b](a,f.field,f.filterControlPlaceholder?f.filterControlPlaceholder:"",f.filterDefault))}if(f.filterControl||""===f.filterDefault||"undefined"==typeof f.filterDefault||($.isEmptyObject(a.filterColumnsPartial)&&(a.filterColumnsPartial={}),a.filterColumnsPartial[f.field]=f.filterDefault),$.each(b.children().children(),(a,b)=>{const d=$(b);if(d.data("field")===f.field)return d.find(".fht-cell").append(c.join("")),!1}),void 0!==f.filterData&&"column"!==f.filterData.toLowerCase()){const b=UtilsFilterControl.getFilterDataMethod(filterDataMethods,f.filterData.substring(0,f.filterData.indexOf(":")));let c,d;if(null!==b)c=f.filterData.substring(f.filterData.indexOf(":")+1,f.filterData.length),d=UtilsFilterControl.getControlContainer(a).find(`.bootstrap-table-filter-control-${UtilsFilterControl.escapeID(f.field)}`),UtilsFilterControl.addOptionToSelectControl(d,"",f.filterControlPlaceholder,f.filterDefault),b(c,d,a.options.filterOrderBy,f.filterDefault);else throw new SyntaxError("Error. You should use any of these allowed filter data methods: var, obj, json, url, func. Use like this: var: {key: \"value\"}")}}}),d?(UtilsFilterControl.getControlContainer(a).off("keyup","input").on("keyup","input",({currentTarget:b,keyCode:c},d)=>{if((c=d?d.keyCode:c,!(a.options.searchOnEnterKey&&13!==c))&&!(-1<$.inArray(c,[37,38,39,40]))){const d=$(b);d.is(":checkbox")||d.is(":radio")||(clearTimeout(b.timeoutId||0),b.timeoutId=setTimeout(()=>{a.onColumnSearch({currentTarget:b,keyCode:c})},a.options.searchTimeOut))}}),UtilsFilterControl.getControlContainer(a).off("change","select").on("change","select",({currentTarget:b,keyCode:c})=>{if(a.options.searchOnEnterKey&&13!==c)return;if(-1<$.inArray(c,[37,38,39,40]))return;const d=$(b),e=d.val();$.trim(e)?(d.find("option[selected]").removeAttr("selected"),d.find("option[value=\""+e+"\"]").attr("selected",!0)):d.find("option[selected]").removeAttr("selected"),clearTimeout(b.timeoutId||0),b.timeoutId=setTimeout(()=>{a.onColumnSearch({currentTarget:b,keyCode:c})},a.options.searchTimeOut)}),b.off("mouseup","input").on("mouseup","input",({currentTarget:b,keyCode:c})=>{const d=$(b),e=d.val();""===e||setTimeout(()=>{const e=d.val();""===e&&(clearTimeout(b.timeoutId||0),b.timeoutId=setTimeout(()=>{a.onColumnSearch({currentTarget:b,keyCode:c})},a.options.searchTimeOut))},1)}),0<UtilsFilterControl.getControlContainer(a).find(".date-filter-control").length&&$.each(a.columns,(b,{filterControl:c,field:d,filterDatepickerOptions:e})=>{c!==void 0&&"datepicker"===c.toLowerCase()&&UtilsFilterControl.getControlContainer(a).find(`.date-filter-control.bootstrap-table-filter-control-${d}`).datepicker(e).on("changeDate",({currentTarget:b,keyCode:c})=>{clearTimeout(b.timeoutId||0),b.timeoutId=setTimeout(()=>{a.onColumnSearch({currentTarget:b,keyCode:c})},a.options.searchTimeOut)})}),"server"!==a.options.sidePagination&&a.triggerSearch()):UtilsFilterControl.getControlContainer(a).find(".filterControl").hide()},getDirectionOfSelectOptions(a){const b=a===void 0?"left":a.toLowerCase();return"left"===b?"ltr":"right"===b?"rtl":"auto"===b?"auto":"ltr"}},filterDataMethods={func(a,b,c,d){const e=window[a].apply();for(const f in e)UtilsFilterControl.addOptionToSelectControl(b,f,e[f],d);UtilsFilterControl.sortSelectControl(b,c)},obj(a,b,c,d){const e=a.split("."),f=e.shift();let g=window[f];for(const f in 0<e.length&&e.forEach(a=>{g=g[a]}),g)UtilsFilterControl.addOptionToSelectControl(b,f,g[f],d);UtilsFilterControl.sortSelectControl(b,c)},var(a,b,c,d){const e=window[a];for(const f in e)UtilsFilterControl.addOptionToSelectControl(b,f,e[f],d);UtilsFilterControl.sortSelectControl(b,c)},url(a,b,c,d){$.ajax({url:a,dataType:"json",success(a){for(const c in a)UtilsFilterControl.addOptionToSelectControl(b,c,a[c],d);UtilsFilterControl.sortSelectControl(b,c)}})},json(a,b,c,d){const e=JSON.parse(a);for(const f in e)UtilsFilterControl.addOptionToSelectControl(b,f,e[f],d);UtilsFilterControl.sortSelectControl(b,c)}};$.extend($.fn.bootstrapTable.defaults,{filterControl:!1,onColumnSearch(){return!1},onCreatedControls(){return!0},alignmentSelectControlOptions:void 0,filterTemplate:{input(a,b,c,d){return Utils.sprintf("<input type=\"text\" class=\"form-control bootstrap-table-filter-control-%s search-input\" style=\"width: 100%;\" placeholder=\"%s\" value=\"%s\">",b,"undefined"==typeof c?"":c,"undefined"==typeof d?"":d)},select({options:a},b){return Utils.sprintf("<select class=\"form-control bootstrap-table-filter-control-%s\" style=\"width: 100%;\" dir=\"%s\"></select>",b,UtilsFilterControl.getDirectionOfSelectOptions(a.alignmentSelectControlOptions))},datepicker(a,b,c){return Utils.sprintf("<input type=\"text\" class=\"form-control date-filter-control bootstrap-table-filter-control-%s\" style=\"width: 100%;\" value=\"%s\">",b,"undefined"==typeof c?"":c)}},disableControlWhenSearch:!1,searchOnEnterKey:!1,valuesFilterControl:[]}),$.extend($.fn.bootstrapTable.columnDefaults,{filterControl:void 0,filterDataCollector:void 0,filterData:void 0,filterDatepickerOptions:void 0,filterStrictSearch:!1,filterStartsWithSearch:!1,filterControlPlaceholder:"",filterDefault:"",filterOrderBy:"asc"}),$.extend($.fn.bootstrapTable.Constructor.EVENTS,{"column-search.bs.table":"onColumnSearch","created-controls.bs.table":"onCreatedControls"}),$.extend($.fn.bootstrapTable.defaults.icons,{clear:{bootstrap3:"glyphicon-trash icon-clear"}[$.fn.bootstrapTable.theme]||"fa-trash"}),$.extend($.fn.bootstrapTable.defaults,$.fn.bootstrapTable.locales),$.extend($.fn.bootstrapTable.defaults,{formatClearSearch(){return"Clear filters"}}),$.fn.bootstrapTable.methods.push("triggerSearch"),$.fn.bootstrapTable.methods.push("clearFilterControl"),$.BootstrapTable=class extends $.BootstrapTable{init(){if(this.options.filterControl){const a=this;this.options.valuesFilterControl=[],this.$el.on("reset-view.bs.table",()=>{if(a.options.height){const b=UtilsFilterControl.getControlContainer(a);0<b.find("select").length||0<b.find("input").length||UtilsFilterControl.createControls(a,b)}}).on("post-header.bs.table",()=>{UtilsFilterControl.setValues(a)}).on("post-body.bs.table",()=>{a.options.height&&!a.options.filterControlContainer&&UtilsFilterControl.fixHeaderCSS(a),this.$tableLoading.css("top",this.$header.outerHeight()+1)}).on("column-switch.bs.table",()=>{UtilsFilterControl.setValues(a)}).on("load-success.bs.table",()=>{a.enableControls(!0)}).on("load-error.bs.table",()=>{a.enableControls(!0)})}super.init()}initHeader(){super.initHeader();this.options.filterControl&&UtilsFilterControl.createControls(this,UtilsFilterControl.getControlContainer(this))}initBody(){super.initBody(),UtilsFilterControl.initFilterSelectControls(this)}initSearch(){const a=this,b=$.isEmptyObject(a.filterColumnsPartial)?null:a.filterColumnsPartial;super.initSearch();"server"===this.options.sidePagination||null===b||(a.data=b?a.data.filter((c,d)=>{const e=[],f=Object.keys(c),g=Object.keys(b),h=f.concat(g.filter(a=>!f.includes(a)));return h.forEach(f=>{const g=a.columns[a.fieldsColumnsIndex[f]],h=(b[f]||"").toLowerCase();let i,j=Utils.getItemField(c,f,!1);if(""===h)i=!0;else if(g&&g.searchFormatter&&(j=$.fn.bootstrapTable.utils.calculateObjectValue(a.header,a.header.formatters[$.inArray(f,a.header.fields)],[j,c,d],j)),-1!==$.inArray(f,a.header.fields))if(void 0===j||null===j)i=!1;else if("string"==typeof j||"number"==typeof j||"boolean"==typeof j){i=g.filterStrictSearch?j.toString().toLowerCase()===h.toString().toLowerCase():g.filterStartsWithSearch?0===`${j}`.toLowerCase().indexOf(h):`${j}`.toLowerCase().includes(h);const b=/(?:(<=|=>|=<|>=|>|<)(?:\s+)?(\d+)?|(\d+)?(\s+)?(<=|=>|=<|>=|>|<))/gm.exec(h);if(b){const a=b[1]||`${b[5]}l`,c=b[2]||b[3],d=parseInt(j,10),e=parseInt(c,10);switch(a){case">":case"<l":i=d>e;break;case"<":case">l":i=d<e;break;case"<=":case"=<":case">=l":case"=>l":i=d<=e;break;case">=":case"=>":case"<=l":case"=<l":i=d>=e;break;default:}}if(g.filterCustomSearch){const b=Utils.calculateObjectValue(a,g.filterCustomSearch,[h,j,f,a.options.data],!0);null!==b&&(i=b)}}e.push(i)}),!e.includes(!1)}):a.data)}initColumnSearch(a){if(UtilsFilterControl.copyValues(this),a)for(const b in this.filterColumnsPartial=a,this.updatePagination(),a)this.trigger("column-search",b,a[b])}onColumnSearch({currentTarget:a,keyCode:b}){if(-1<$.inArray(b,[37,38,39,40]))return;UtilsFilterControl.copyValues(this);const c=$.trim($(a).val()),d=$(a).closest("[data-field]").data("field");$.isEmptyObject(this.filterColumnsPartial)&&(this.filterColumnsPartial={}),c?this.filterColumnsPartial[d]=c:delete this.filterColumnsPartial[d],this.options.pageNumber=1,this.enableControls(!1),this.onSearch({currentTarget:a},!1),this.trigger("column-search",d,c)}initToolbar(){this.showSearchClearButton=this.options.filterControl&&this.options.showSearchClearButton,super.initToolbar()}resetSearch(a){this.options.filterControl&&this.options.showSearchClearButton&&this.clearFilterControl(),super.resetSearch(a)}clearFilterControl(){if(this.options.filterControl){const a=this,b=UtilsFilterControl.collectBootstrapCookies(),c=UtilsFilterControl.getCurrentHeader(a),d=c.closest("table"),e=c.find(UtilsFilterControl.getCurrentSearchControls(a)),f=a.$toolbar.find(".search input");let g=!1,h=0;if($.each(a.options.valuesFilterControl,(a,b)=>{g=!!g||""!==b.value,b.value=""}),$.each(a.options.filterControls,(a,b)=>{b.text=""}),UtilsFilterControl.setValues(a),clearTimeout(h),h=setTimeout(()=>{b&&0<b.length&&$.each(b,(b,c)=>{void 0!==a.deleteCookie&&a.deleteCookie(c)})},a.options.searchTimeOut),!g)return;if(0<e.length)this.filterColumnsPartial={},$(e[0]).trigger("INPUT"===e[0].tagName?"keyup":"change",{keyCode:13});else return;if(0<f.length&&a.resetSearch(),a.options.sortName!==d.data("sortName")||a.options.sortOrder!==d.data("sortOrder")){const b=c.find(Utils.sprintf("[data-field=\"%s\"]",$(e[0]).closest("table").data("sortName")));0<b.length&&(a.onSort({type:"keypress",currentTarget:b}),$(b).find(".sortable").trigger("click"))}}}triggerSearch(){const a=UtilsFilterControl.getSearchControls(this);a.each(function(){const a=$(this);a.is("select")?a.change():a.keyup()})}enableControls(a){if(this.options.disableControlWhenSearch&&"server"===this.options.sidePagination){const b=UtilsFilterControl.getSearchControls(this);a?b.removeProp("disabled"):b.prop("disabled","disabled")}}};
